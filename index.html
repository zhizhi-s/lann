<!DOCTYPE html>
<html lang="ku">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>کتێبخانەی کۆلێژی تەکنیکی شەقڵاوە</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Noto Sans Arabic', system-ui, -apple-system, sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        :root {
            --primary-color: #0F4C75;
            --secondary-color: #3282B8;
            --accent-color: #BBE1FA;
            --light-color: #F9FBFF;
            --dark-color: #1B262C;
            --gray-color: #E8EAED;
            --text-color: #2D3748;
            --success-color: #38B2AC;
            --warning-color: #ED8936;
            --danger-color: #F56565;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-hover: 0 8px 24px rgba(0, 0, 0, 0.12);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --gradient: linear-gradient(135deg, #0F4C75 0%, #3282B8 100%);
            --gradient-accent: linear-gradient(135deg, #3282B8 0%, #BBE1FA 100%);
            
            /* Colors for Dark Mode */
            --dark-bg: #0f172a;
            --dark-card: #1e293b;
            --dark-text: #e5e7eb;
            --dark-border: #334155;
            --dark-primary: #4f46e5;
            --dark-secondary: #22c55e;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            color: var(--text-color);
            min-height: 100vh;
            line-height: 1.6;
            transition: var(--transition);
            font-size: 15px;
            text-align: right;
            direction: rtl;
        }

        /* Dark Mode Styles */
        body.dark-mode {
            background: var(--dark-bg);
            color: var(--dark-text);
        }

        /* ====== HEADER ====== */
        header {
            background: var(--gradient);
            color: white;
            padding: 0.8rem 1rem;
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            transition: var(--transition);
            height: 70px;
        }

        body.dark-mode header {
            background: linear-gradient(135deg, var(--dark-primary) 0%, #3730a3 100%);
        }

        .logo {
            flex: 1;
            min-width: 0;
        }

        .logo h1 {
            font-size: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.2rem;
            line-height: 1.3;
            text-align: right;
            overflow: hidden;
        }

        .logo h1 span:first-child {
            font-weight: 700;
            font-size: 1.1rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .welcome-text {
            color: var(--accent-color);
            font-weight: 500;
            font-size: 0.75rem;
            letter-spacing: 0.3px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        body.dark-mode .welcome-text {
            color: #93c5fd;
        }

        .admin-login-btn {
            background: rgba(255, 255, 255, 0.15);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 0.5rem 0.8rem;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.4rem;
            backdrop-filter: blur(5px);
            font-size: 0.75rem;
            white-space: nowrap;
            flex-shrink: 0;
            margin-right: 0.5rem;
        }

        .admin-login-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-1px);
        }

        .admin-login-btn i {
            font-size: 0.9rem;
        }

        /* ====== CONTAINER ====== */
        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 1rem;
            margin-top: 70px;
            margin-bottom: 70px;
            min-height: calc(100vh - 140px);
        }

        /* ====== BOTTOM NAVIGATION BAR ====== */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid var(--gray-color);
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 0.5rem 0;
            z-index: 1000;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            height: 70px;
        }

        body.dark-mode .bottom-nav {
            background: var(--dark-card);
            border-top-color: var(--dark-border);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 0.3rem;
            padding: 0.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            flex: 1;
            max-width: 33.33%;
            text-decoration: none;
            color: var(--text-color);
            position: relative;
        }

        body.dark-mode .nav-item {
            color: var(--dark-text);
        }

        .nav-item.active {
            background: var(--light-color);
            color: var(--primary-color);
        }

        body.dark-mode .nav-item.active {
            background: var(--dark-bg);
            color: var(--dark-primary);
        }

        .nav-item:hover {
            background: var(--light-color);
            transform: translateY(-2px);
        }

        body.dark-mode .nav-item:hover {
            background: var(--dark-bg);
        }

        .nav-icon {
            font-size: 1.2rem;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .nav-text {
            font-size: 0.7rem;
            font-weight: 500;
            text-align: center;
            white-space: nowrap;
        }

        /* بادج بۆ کتێبە وەرگیراوەکان */
        .borrowed-badge {
            position: absolute;
            top: -5px;
            right: 0px;
            background: var(--danger-color);
            color: white;
            font-size: 0.65rem;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            z-index: 10;
        }

        body.dark-mode .borrowed-badge {
            border-color: var(--dark-card);
        }

        /* ====== SEARCH SECTION ====== */
        .search-section {
            background: white;
            padding: 1.2rem;
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-bottom: 1.5rem;
            position: relative;
            overflow: hidden;
            transition: var(--transition);
        }

        body.dark-mode .search-section {
            background: var(--dark-card);
        }

        .search-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient);
        }

        .search-box {
            width: 100%;
            position: relative;
            margin-bottom: 1.2rem;
        }

        .search-box input {
            width: 100%;
            padding: 0.9rem 1rem;
            padding-right: 3rem;
            border: 1.5px solid var(--gray-color);
            border-radius: 10px;
            font-size: 0.95rem;
            transition: var(--transition);
            background: var(--light-color);
            color: var(--text-color);
            font-family: 'Noto Sans Arabic', 'Segoe UI', sans-serif;
        }

        body.dark-mode .search-box input {
            background: #0f172a;
            border-color: var(--dark-border);
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 2px rgba(50, 130, 184, 0.1);
        }

        .search-box i {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--secondary-color);
            font-size: 1rem;
        }

        .genre-section {
            width: 100%;
        }

        .genre-btn {
            background: var(--gradient);
            color: white;
            border: none;
            padding: 0.7rem 1.2rem;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 1rem;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 4px 15px rgba(15, 76, 117, 0.3);
            width: 100%;
            justify-content: center;
        }

        .genre-btn i {
            font-size: 0.9rem;
        }

        .genre-list {
            display: none;
            background: white;
            border: 1.5px solid var(--gray-color);
            border-radius: 10px;
            padding: 1rem;
            margin-top: 0.5rem;
            max-height: 250px;
            overflow-y: auto;
            box-shadow: var(--shadow);
            animation: fadeIn 0.3s ease;
            transition: var(--transition);
        }

        body.dark-mode .genre-list {
            background: var(--dark-card);
            border-color: var(--dark-border);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .genre-list.active {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 0.5rem;
        }

        .genre-item {
            padding: 0.7rem;
            cursor: pointer;
            border-radius: 8px;
            text-align: center;
            transition: var(--transition);
            background: var(--light-color);
            border: 1px solid transparent;
            font-size: 0.85rem;
            font-weight: 500;
        }

        body.dark-mode .genre-item {
            background: #0f172a;
        }

        .genre-item:hover {
            background: var(--secondary-color);
            color: white;
            transform: translateY(-1px);
        }

        .genre-item.active {
            background: var(--secondary-color);
            color: white;
            border-color: var(--secondary-color);
        }

        body.dark-mode .genre-item.active {
            background: var(--dark-primary);
        }

        /* ====== SECTION HEADER ====== */
        .section-header {
            text-align: center;
            margin-bottom: 1.5rem;
            padding: 0 0.5rem;
        }

        .section-header h2 {
            font-size: 1.4rem;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
            position: relative;
            display: inline-block;
            font-weight: 700;
        }

        body.dark-mode .section-header h2 {
            color: var(--dark-primary);
        }

        .section-header h2::after {
            content: '';
            position: absolute;
            bottom: -6px;
            right: 50%;
            transform: translateX(50%);
            width: 50px;
            height: 3px;
            background: var(--gradient-accent);
            border-radius: 2px;
        }

        .section-header p {
            color: #666;
            font-size: 0.9rem;
            max-width: 100%;
            margin: 0 auto;
            line-height: 1.5;
        }

        body.dark-mode .section-header p {
            color: #cbd5e1;
        }

        /* ====== STATS CONTAINER ====== */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.8rem;
            margin-bottom: 1.5rem;
        }

        .stat-card {
            background: white;
            padding: 1rem 0.8rem;
            border-radius: 10px;
            box-shadow: var(--shadow);
            text-align: center;
            transition: var(--transition);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 85px;
        }

        body.dark-mode .stat-card {
            background: var(--dark-card);
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }

        .stat-number {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 0.3rem;
            line-height: 1;
        }

        body.dark-mode .stat-number {
            color: var(--dark-primary);
        }

        .stat-label {
            color: #666;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        body.dark-mode .stat-label {
            color: #cbd5e1;
        }

        /* ====== BOOKS GRID ====== */
        .books-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.8rem;
            padding: 0.2rem;
        }

        .book-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            cursor: pointer;
            position: relative;
            height: 100%;
            display: flex;
            flex-direction: column;
            max-height: 290px;
        }

        body.dark-mode .book-card {
            background: var(--dark-card);
        }

        .book-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-hover);
        }

        .book-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient);
        }

        .book-image {
            width: 100%;
            height: 150px;
            object-fit: cover;
            transition: transform 0.5s ease;
        }

        .book-card:hover .book-image {
            transform: scale(1.05);
        }

        .book-info {
            padding: 0.8rem;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            min-height: 100px;
        }

        .book-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(15, 76, 117, 0.95);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 10px;
            font-size: 0.55rem;
            font-weight: 600;
            z-index: 10;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            border: 1px solid white;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        body.dark-mode .book-badge {
            background: rgba(79, 70, 229, 0.95);
        }

        /* نشان وضعیت امانت کتاب */
        .book-status-badge {
            position: absolute;
            top: 40px;
            right: 8px;
            background: linear-gradient(135deg, #f56565 0%, #ed8936 100%);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 10px;
            font-size: 0.5rem;
            font-weight: 600;
            z-index: 9;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            border: 1px solid white;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            max-width: 70px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        body.dark-mode .book-status-badge {
            background: linear-gradient(135deg, #dc2626 0%, #ea580c 100%);
        }

        .book-title {
            font-weight: 700;
            margin-bottom: 0.3rem;
            color: var(--dark-color);
            font-size: 0.9rem;
            line-height: 1.3;
            height: 2.2em;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        body.dark-mode .book-title {
            color: var(--dark-text);
        }

        .book-author {
            color: var(--secondary-color);
            font-size: 0.75rem;
            font-weight: 500;
            margin-bottom: 0.2rem;
            display: flex;
            align-items: center;
            gap: 0.3rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        body.dark-mode .book-author {
            color: var(--dark-primary);
        }

        .book-author i {
            font-size: 0.7rem;
        }

        .book-genre {
            color: #666;
            font-size: 0.7rem;
            margin-bottom: 0.3rem;
            display: flex;
            align-items: center;
            gap: 0.3rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        body.dark-mode .book-genre {
            color: #cbd5e1;
        }

        .book-genre i {
            font-size: 0.65rem;
        }

        /* ====== MODALS ====== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1100;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            animation: modalFadeIn 0.3s ease;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            width: 95%;
            max-width: 500px;
            max-height: 85vh;
            overflow-y: auto;
            position: relative;
            padding: 1.5rem;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.4s ease;
        }

        body.dark-mode .modal-content {
            background: var(--dark-card);
        }

        @keyframes modalSlideIn {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .close-modal {
            position: absolute;
            top: 0.8rem;
            left: 0.8rem;
            font-size: 1.3rem;
            cursor: pointer;
            color: var(--secondary-color);
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: var(--transition);
            background: var(--light-color);
            z-index: 1101;
        }

        body.dark-mode .close-modal {
            background: #0f172a;
            color: var(--dark-primary);
        }

        .close-modal:hover {
            background: var(--secondary-color);
            color: white;
            transform: rotate(90deg);
        }

        /* ====== FORMS ====== */
        .form-group {
            margin-bottom: 1.2rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--dark-color);
            font-size: 0.9rem;
            text-align: right;
        }

        body.dark-mode .form-group label {
            color: var(--dark-text);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.8rem;
            border: 1.5px solid var(--gray-color);
            border-radius: 8px;
            font-size: 0.9rem;
            transition: var(--transition);
            background: var(--light-color);
            color: var(--text-color);
            font-family: 'Noto Sans Arabic', 'Segoe UI', sans-serif;
            text-align: right;
        }

        body.dark-mode .form-group input,
        body.dark-mode .form-group select,
        body.dark-mode .form-group textarea {
            background: #0f172a;
            border-color: var(--dark-border);
            color: var(--dark-text);
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 2px rgba(50, 130, 184, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-buttons {
            display: flex;
            flex-direction: column;
            gap: 0.7rem;
            margin-top: 1.5rem;
        }

        .submit-btn, .cancel-btn {
            padding: 0.8rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            border: none;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            width: 100%;
        }

        .submit-btn {
            background: var(--gradient);
            color: white;
        }

        body.dark-mode .submit-btn {
            background: linear-gradient(135deg, var(--dark-primary) 0%, #3730a3 100%);
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(15, 76, 117, 0.3);
        }

        .cancel-btn {
            background: #718096;
            color: white;
        }

        body.dark-mode .cancel-btn {
            background: #475569;
        }

        .cancel-btn:hover {
            background: #4A5568;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(113, 128, 150, 0.3);
        }

        /* ====== ADMIN PANEL ====== */
        #adminPanel {
            margin-top: 70px;
            padding: 1rem;
            margin-bottom: 70px;
        }

        .admin-actions {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.8rem;
            margin-bottom: 1.5rem;
        }

        .admin-action-btn {
            background: var(--gradient);
            color: white;
            border: none;
            padding: 0.9rem;
            border-radius: 10px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            box-shadow: var(--shadow);
            text-align: center;
        }

        body.dark-mode .admin-action-btn {
            background: linear-gradient(135deg, var(--dark-primary) 0%, #3730a3 100%);
        }

        .admin-action-btn i {
            font-size: 0.9rem;
        }

        .admin-action-btn.secondary {
            background: #4FD1C7;
        }

        .admin-action-btn.danger {
            background: #FC8181;
        }

        /* ====== ADMIN TABLES ====== */
        .admin-table-container {
            background: white;
            border-radius: 12px;
            padding: 1rem;
            box-shadow: var(--shadow);
            overflow-x: auto;
            margin-bottom: 1.5rem;
            -webkit-overflow-scrolling: touch;
        }

        body.dark-mode .admin-table-container {
            background: var(--dark-card);
        }

        .admin-table {
            width: 100%;
            border-collapse: collapse;
            border-spacing: 0;
            font-size: 0.85rem;
        }

        .admin-table th {
            background: var(--gradient);
            color: white;
            padding: 0.8rem;
            text-align: right;
            font-weight: 600;
            border: none;
            font-size: 0.8rem;
            white-space: nowrap;
        }

        .admin-table td {
            padding: 0.7rem;
            text-align: right;
            border-bottom: 1px solid var(--gray-color);
            background: white;
            transition: var(--transition);
        }

        body.dark-mode .admin-table td {
            background: var(--dark-card);
            border-bottom-color: var(--dark-border);
        }

        .admin-table tr:last-child td {
            border-bottom: none;
        }

        .admin-table tr:hover td {
            background: var(--light-color);
        }

        body.dark-mode .admin-table tr:hover td {
            background: #1e293b;
        }

        /* ====== MOBILE FRIENDLY TABLES ====== */
        /* برای نمایش بهتر در موبایل */
        .mobile-friendly-table {
            display: block;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            border-radius: 10px;
            background: white;
            box-shadow: var(--shadow);
        }

        body.dark-mode .mobile-friendly-table {
            background: var(--dark-card);
        }

        .mobile-table-row {
            display: flex;
            flex-direction: column;
            padding: 1rem;
            border-bottom: 1px solid var(--gray-color);
            transition: var(--transition);
        }

        body.dark-mode .mobile-table-row {
            border-bottom-color: var(--dark-border);
        }

        .mobile-table-row:hover {
            background: var(--light-color);
        }

        body.dark-mode .mobile-table-row:hover {
            background: #1e293b;
        }

        .mobile-table-row:last-child {
            border-bottom: none;
        }

        .mobile-table-cell {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }

        body.dark-mode .mobile-table-cell {
            border-bottom-color: rgba(255,255,255,0.05);
        }

        .mobile-table-cell:last-child {
            border-bottom: none;
        }

        .mobile-table-label {
            font-weight: 600;
            color: var(--primary-color);
            min-width: 100px;
            margin-left: 0.5rem;
        }

        body.dark-mode .mobile-table-label {
            color: var(--dark-primary);
        }

        .mobile-table-value {
            flex: 1;
            text-align: left;
            word-break: break-word;
        }

        /* ====== ACTION BUTTONS ====== */
        .action-btn {
            padding: 0.3rem 0.6rem;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            margin-left: 0.3rem;
            transition: var(--transition);
            font-size: 0.75rem;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 0.2rem;
            white-space: nowrap;
        }

        .edit-btn {
            background: var(--accent-color);
            color: var(--dark-color);
        }

        .delete-btn {
            background: #FED7D7;
            color: #C53030;
        }

        .approve-btn {
            background: #C6F6D5;
            color: #276749;
        }

        .reject-btn {
            background: #FEFCBF;
            color: #975A16;
        }

        .mobile-action-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 0.3rem;
            margin-top: 0.5rem;
            justify-content: center;
        }

        .mobile-action-btn {
            flex: 1;
            min-width: 45%;
            padding: 0.4rem 0.6rem;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.7rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.3rem;
            text-align: center;
        }

        .mobile-edit-btn {
            background: var(--accent-color);
            color: var(--dark-color);
        }

        .mobile-delete-btn {
            background: #FED7D7;
            color: #C53030;
        }

        .mobile-approve-btn {
            background: #C6F6D5;
            color: #276749;
        }

        .mobile-reject-btn {
            background: #FEFCBF;
            color: #975A16;
        }

        /* ====== TABS ====== */
        .tabs {
            display: flex;
            gap: 0.3rem;
            margin-bottom: 1.2rem;
            border-bottom: 2px solid var(--gray-color);
            padding-bottom: 0.3rem;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .tab-btn {
            padding: 0.5rem 0.8rem;
            background: none;
            border: none;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            font-weight: 600;
            color: #718096;
            transition: var(--transition);
            font-size: 0.8rem;
            flex-shrink: 0;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .tab-btn i {
            font-size: 0.8rem;
        }

        .tab-btn.active {
            background: var(--secondary-color);
            color: white;
        }

        body.dark-mode .tab-btn.active {
            background: var(--dark-primary);
        }

        /* ====== WISHLIST SIDEBAR ====== */
        .wishlist-sidebar {
            position: fixed;
            top: 0;
            right: -100%;
            width: 85%;
            max-width: 320px;
            height: 100vh;
            background: white;
            z-index: 1500;
            transition: var(--transition);
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            border-radius: 0;
        }

        body.dark-mode .wishlist-sidebar {
            background: var(--dark-card);
        }

        .wishlist-sidebar.active {
            right: 0;
        }

        .wishlist-header {
            background: var(--gradient);
            color: white;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 0;
        }

        .wishlist-header h3 {
            margin: 0;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
        }

        .close-wishlist {
            background: none;
            border: none;
            color: white;
            font-size: 1.1rem;
            cursor: pointer;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: var(--transition);
        }

        .wishlist-content {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            -webkit-overflow-scrolling: touch;
        }

        .wishlist-empty {
            text-align: center;
            padding: 2rem 1rem;
            color: #718096;
        }

        .wishlist-empty i {
            font-size: 2.5rem;
            margin-bottom: 0.8rem;
            color: #CBD5E0;
        }

        .wishlist-item {
            display: flex;
            align-items: center;
            padding: 0.8rem;
            border-radius: 8px;
            background: var(--light-color);
            margin-bottom: 0.7rem;
            transition: var(--transition);
            gap: 0.8rem;
        }

        body.dark-mode .wishlist-item {
            background: #0f172a;
        }

        .wishlist-item-image {
            width: 50px;
            height: 65px;
            object-fit: cover;
            border-radius: 6px;
            flex-shrink: 0;
        }

        .wishlist-item-info {
            flex: 1;
            min-width: 0;
        }

        .wishlist-item-title {
            font-weight: 600;
            margin-bottom: 0.2rem;
            font-size: 0.85rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .wishlist-item-author {
            font-size: 0.75rem;
            color: #666;
            margin-bottom: 0.4rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .wishlist-item-actions {
            display: flex;
            gap: 0.4rem;
        }

        .wishlist-remove-btn {
            background: none;
            border: none;
            color: var(--danger-color);
            cursor: pointer;
            font-size: 0.9rem;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: var(--transition);
        }

        .wishlist-borrow-btn {
            background: var(--gradient);
            color: white;
            border: none;
            padding: 0.4rem 0.8rem;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.75rem;
            transition: var(--transition);
            white-space: nowrap;
        }

        /* ====== BORROWED BOOKS SIDEBAR ====== */
        .borrowed-sidebar {
            position: fixed;
            top: 0;
            left: -100%;
            width: 85%;
            max-width: 320px;
            height: 100vh;
            background: white;
            z-index: 1500;
            transition: var(--transition);
            box-shadow: 5px 0 15px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            border-radius: 0;
        }

        body.dark-mode .borrowed-sidebar {
            background: var(--dark-card);
        }

        .borrowed-sidebar.active {
            left: 0;
        }

        .borrowed-header {
            background: linear-gradient(135deg, #38B2AC 0%, #0D9488 100%);
            color: white;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 0;
        }

        .borrowed-header h3 {
            margin: 0;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
        }

        .close-borrowed {
            background: none;
            border: none;
            color: white;
            font-size: 1.1rem;
            cursor: pointer;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: var(--transition);
        }

        .borrowed-content {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            -webkit-overflow-scrolling: touch;
        }

        .borrowed-empty {
            text-align: center;
            padding: 2rem 1rem;
            color: #718096;
        }

        .borrowed-empty i {
            font-size: 2.5rem;
            margin-bottom: 0.8rem;
            color: #CBD5E0;
        }

        .borrowed-item {
            display: flex;
            align-items: center;
            padding: 0.8rem;
            border-radius: 8px;
            background: var(--light-color);
            margin-bottom: 0.7rem;
            transition: var(--transition);
            gap: 0.8rem;
        }

        body.dark-mode .borrowed-item {
            background: #0f172a;
        }

        .borrowed-item-image {
            width: 50px;
            height: 65px;
            object-fit: cover;
            border-radius: 6px;
            flex-shrink: 0;
        }

        .borrowed-item-info {
            flex: 1;
            min-width: 0;
        }

        .borrowed-item-title {
            font-weight: 600;
            margin-bottom: 0.2rem;
            font-size: 0.85rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .borrowed-item-author {
            font-size: 0.75rem;
            color: #666;
            margin-bottom: 0.2rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .borrowed-item-date {
            font-size: 0.7rem;
            color: #718096;
        }

        .borrowed-item-status {
            padding: 0.2rem 0.5rem;
            border-radius: 12px;
            font-size: 0.65rem;
            font-weight: 600;
            margin-top: 0.3rem;
            display: inline-block;
        }

        .status-borrowed {
            background: #D1FAE5;
            color: #065F46;
        }

        /* ====== FOOTER ====== */
        footer {
            background: var(--dark-color);
            color: white;
            text-align: center;
            padding: 1.5rem 1rem;
            margin-top: 2rem;
            position: relative;
            font-size: 0.85rem;
            margin-bottom: 70px;
        }

        body.dark-mode footer {
            background: #0f172a;
        }

        footer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient);
        }

        footer p {
            margin: 0.4rem 0;
            color: #CBD5E0;
            font-size: 0.85rem;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
        }

        footer i {
            margin-left: 0.5rem;
        }

        /* ====== UTILITY CLASSES ====== */
        .empty-state {
            text-align: center;
            padding: 2rem 1rem;
            color: #718096;
        }

        .empty-state i {
            font-size: 2.5rem;
            color: #CBD5E0;
            margin-bottom: 0.8rem;
        }

        .empty-state h3 {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            color: #4A5568;
        }

        body.dark-mode .empty-state h3 {
            color: #cbd5e1;
        }

        .loading {
            text-align: center;
            padding: 2rem 1rem;
            color: var(--primary-color);
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--gray-color);
            border-top: 3px solid var(--secondary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .notification {
            position: fixed;
            top: 80px;
            right: 15px;
            padding: 0.8rem 1rem;
            border-radius: 10px;
            color: white;
            z-index: 2000;
            animation: slideIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            max-width: 300px;
            font-size: 0.85rem;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .success-notification {
            background: var(--success-color);
            border-left: 3px solid #2C7A7B;
        }

        .error-notification {
            background: var(--danger-color);
            border-left: 3px solid #C53030;
        }

        .warning-notification {
            background: var(--warning-color);
            border-left: 3px solid #DD6B20;
        }

        .badge {
            display: inline-block;
            padding: 0.2rem 0.5rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-badge {
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-block;
            white-space: nowrap;
        }

        .status-pending {
            background: #FEF3C7;
            color: #92400E;
        }

        .status-approved {
            background: #D1FAE5;
            color: #065F46;
        }

        .status-rejected {
            background: #FEE2E2;
            color: #991B1B;
        }

        /* ====== SCROLLBAR ====== */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: var(--gray-color);
            border-radius: 3px;
        }

        body.dark-mode ::-webkit-scrollbar-track {
            background: var(--dark-border);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--secondary-color);
            border-radius: 3px;
        }

        body.dark-mode ::-webkit-scrollbar-thumb {
            background: var(--dark-primary);
        }

        /* ====== بازسازی کامل برای موبایل ====== */
        @media (max-width: 767px) {
            .stats-container {
                grid-template-columns: repeat(3, 1fr);
                gap: 0.6rem;
                margin-bottom: 1.2rem;
            }
            
            .stat-card {
                min-height: 70px;
                padding: 0.8rem 0.4rem;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
            }
            
            .stat-number {
                font-size: 1.5rem;
                margin-bottom: 0.2rem;
                line-height: 1;
            }
            
            .stat-label {
                font-size: 0.65rem;
                text-align: center;
                line-height: 1.2;
            }
            
            /* ====== کتێبەکان - کاهش ارتفاع کارت ====== */
            .books-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.6rem;
            }
            
            .book-card {
                max-height: 260px;
            }
            
            .book-image {
                height: 130px;
            }
            
            .book-info {
                padding: 0.6rem;
                min-height: 90px;
            }
            
            .book-title {
                font-size: 0.82rem;
                height: 2em;
                -webkit-line-clamp: 2;
            }
            
            .book-author {
                font-size: 0.7rem;
                margin-bottom: 0.1rem;
            }
            
            .book-genre {
                font-size: 0.65rem;
                margin-bottom: 0.2rem;
            }
            
            .book-badge {
                font-size: 0.5rem;
                padding: 0.2rem 0.4rem;
            }
            
            .book-status-badge {
                font-size: 0.45rem;
                padding: 0.2rem 0.3rem;
                max-width: 60px;
                top: 35px;
            }
            
            /* ====== BOTTOM NAVIGATION ====== */
            .bottom-nav {
                height: 65px;
            }
            
            .nav-icon {
                font-size: 1.1rem;
            }
            
            .nav-text {
                font-size: 0.65rem;
            }
            
            .borrowed-badge {
                font-size: 0.55rem;
                width: 16px;
                height: 16px;
                top: -2px;
                right: 0px;
            }

            /* ====== ADMIN TABLES FOR MOBILE ====== */
            .admin-table-container {
                padding: 0.5rem;
            }

            .admin-table {
                display: none; /* نمایش جدول اصلی در موبایل غیرفعال */
            }

            .mobile-friendly-table {
                display: block;
            }

            .mobile-table-row {
                padding: 0.8rem;
                margin-bottom: 0.8rem;
                border: 1px solid var(--gray-color);
                border-radius: 8px;
            }

            body.dark-mode .mobile-table-row {
                border-color: var(--dark-border);
            }

            .mobile-table-cell {
                padding: 0.4rem 0;
            }

            .mobile-table-label {
                min-width: 80px;
                font-size: 0.75rem;
            }

            .mobile-table-value {
                font-size: 0.8rem;
                text-align: right;
            }

            .mobile-action-buttons {
                margin-top: 0.8rem;
                gap: 0.4rem;
            }

            .mobile-action-btn {
                min-width: 100%;
                padding: 0.5rem;
                font-size: 0.75rem;
            }

            /* ====== TABS ====== */
            .tabs {
                gap: 0.2rem;
            }

            .tab-btn {
                padding: 0.4rem 0.6rem;
                font-size: 0.7rem;
            }

            /* ====== BOOK MANAGEMENT ====== */
            .book-image-thumb {
                width: 40px;
                height: 50px;
                object-fit: cover;
                border-radius: 5px;
            }
        }

        /* ====== تەنها لە تەلەفۆنی بچووک (360px) ====== */
        @media (max-width: 360px) {
            .stats-container {
                grid-template-columns: repeat(3, 1fr);
                gap: 0.4rem;
            }
            
            .stat-card {
                min-height: 65px;
                padding: 0.6rem 0.3rem;
            }
            
            .stat-number {
                font-size: 1.3rem;
            }
            
            .stat-label {
                font-size: 0.6rem;
            }
            
            .books-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.5rem;
            }
            
            .book-card {
                max-height: 250px;
            }
            
            .book-image {
                height: 120px;
            }
            
            .book-title {
                font-size: 0.78rem;
                height: 1.8em;
            }
            
            .book-author {
                font-size: 0.68rem;
            }
            
            .book-genre {
                font-size: 0.62rem;
            }
            
            .book-badge {
                font-size: 0.48rem;
                padding: 0.18rem 0.35rem;
            }
            
            .book-status-badge {
                font-size: 0.42rem;
                padding: 0.18rem 0.3rem;
                max-width: 55px;
                top: 35px;
            }
            
            .bottom-nav {
                height: 60px;
            }
            
            .nav-text {
                font-size: 0.6rem;
            }
            
            .borrowed-badge {
                font-size: 0.5rem;
                width: 15px;
                height: 15px;
                top: -2px;
            }

            .mobile-table-row {
                padding: 0.6rem;
            }

            .mobile-table-label {
                min-width: 70px;
                font-size: 0.7rem;
            }

            .mobile-table-value {
                font-size: 0.75rem;
            }

            .mobile-action-btn {
                padding: 0.4rem;
                font-size: 0.7rem;
            }
        }

        /* ====== شاشە بچووکەکان (تەلەفۆن) ====== */
        @media (max-width: 480px) {
            .container {
                padding: 0.8rem;
                margin-top: 70px;
            }
            
            header {
                padding: 0.8rem 0.8rem;
                height: 70px;
            }
            
            .logo h1 span:first-child {
                font-size: 0.9rem;
            }
            
            .welcome-text {
                font-size: 0.65rem;
            }
            
            .admin-login-btn {
                padding: 0.4rem 0.7rem;
                font-size: 0.65rem;
            }
            
            .search-section {
                padding: 0.8rem;
            }
            
            .search-box input {
                padding: 0.7rem;
                padding-right: 2.5rem;
                font-size: 0.9rem;
            }
            
            .genre-btn {
                padding: 0.6rem 1rem;
                font-size: 0.8rem;
            }
            
            .section-header h2 {
                font-size: 1.2rem;
            }
            
            .section-header p {
                font-size: 0.8rem;
            }
            
            .stats-container {
                grid-template-columns: repeat(3, 1fr);
                gap: 0.5rem;
            }
            
            .books-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.5rem;
            }
            
            .book-card {
                max-height: 270px;
            }
            
            .book-image {
                height: 130px;
            }
            
            .book-info {
                padding: 0.5rem;
                min-height: 95px;
            }
            
            .book-title {
                font-size: 0.8rem;
                height: 2em;
            }
            
            .book-author {
                font-size: 0.72rem;
            }
            
            .book-genre {
                font-size: 0.68rem;
            }
            
            .book-badge {
                font-size: 0.52rem;
            }
            
            .book-status-badge {
                font-size: 0.48rem;
            }
            
            .borrowed-badge {
                font-size: 0.5rem;
                width: 15px;
                height: 15px;
            }
            
            .admin-actions {
                grid-template-columns: 1fr;
                gap: 0.6rem;
            }
            
            .admin-action-btn {
                padding: 0.7rem;
                font-size: 0.75rem;
            }
            
            .wishlist-sidebar {
                width: 90%;
            }
            
            .borrowed-sidebar {
                width: 90%;
            }
        }

        /* ====== تەبلێتە بچووکەکان ====== */
        @media (min-width: 481px) and (max-width: 767px) {
            .stats-container {
                grid-template-columns: repeat(3, 1fr);
                gap: 0.8rem;
            }
            
            .books-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.8rem;
            }
            
            .book-card {
                max-height: 280px;
            }
            
            .book-image {
                height: 150px;
            }
            
            .book-title {
                font-size: 0.85rem;
            }
            
            .book-genre {
                font-size: 0.72rem;
            }
            
            .book-badge {
                font-size: 0.58rem;
            }
            
            .book-status-badge {
                font-size: 0.53rem;
            }
        }

        /* ====== RESPONSIVE DESIGN ====== */
        @media (min-width: 768px) {
            .container {
                max-width: 1200px;
                padding: 2rem;
                margin-top: 80px;
                margin-bottom: 80px;
            }
            
            header {
                padding: 1rem 2rem;
                height: 80px;
            }
            
            .logo h1 {
                font-size: 1.4rem;
            }
            
            .welcome-text {
                font-size: 0.9rem;
            }
            
            .admin-login-btn {
                padding: 0.7rem 1.5rem;
                font-size: 0.9rem;
            }
            
            .search-section {
                padding: 2rem;
            }
            
            .section-header h2 {
                font-size: 2rem;
            }
            
            .section-header p {
                font-size: 1rem;
            }
            
            .stats-container {
                grid-template-columns: repeat(3, 1fr);
                gap: 1.5rem;
            }
            
            .stat-card {
                padding: 1.5rem;
            }
            
            .stat-number {
                font-size: 2.2rem;
            }
            
            .books-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: 1.5rem;
                padding: 0.5rem;
            }
            
            .book-card {
                max-height: 350px;
            }
            
            .book-image {
                height: 200px;
            }
            
            .book-info {
                min-height: 120px;
            }
            
            .book-title {
                font-size: 1rem;
            }
            
            .book-genre {
                font-size: 0.8rem;
            }
            
            .book-badge {
                font-size: 0.65rem;
            }
            
            .book-status-badge {
                font-size: 0.6rem;
            }
            
            .admin-actions {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }
            
            .wishlist-sidebar {
                width: 380px;
            }
            
            .borrowed-sidebar {
                width: 380px;
            }
            
            .bottom-nav {
                height: 75px;
            }
            
            .nav-icon {
                font-size: 1.3rem;
            }
            
            .nav-text {
                font-size: 0.8rem;
            }
            
            .borrowed-badge {
                font-size: 0.7rem;
                width: 20px;
                height: 20px;
                top: -4px;
                right: 0px;
            }

            /* ====== ADMIN TABLES FOR DESKTOP ====== */
            .mobile-friendly-table {
                display: none; /* نمایش جدول موبایل در دسکتاپ غیرفعال */
            }

            .admin-table {
                display: table; /* نمایش جدول اصلی در دسکتاپ فعال */
                min-width: 600px;
            }
        }

        /* ====== پشتگیری باشتر بۆ شاشە بچووکەکان ====== */
        @media (max-width: 320px) {
            .stats-container {
                grid-template-columns: repeat(3, 1fr);
                gap: 0.3rem;
            }
            
            .stat-card {
                padding: 0.5rem 0.2rem;
                min-height: 60px;
            }
            
            .stat-number {
                font-size: 1.2rem;
            }
            
            .stat-label {
                font-size: 0.55rem;
            }
            
            .books-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.4rem;
            }
            
            .book-card {
                max-height: 240px;
            }
            
            .book-image {
                height: 110px;
            }
            
            .book-title {
                font-size: 0.75rem;
                height: 1.8em;
            }
            
            .book-author {
                font-size: 0.65rem;
            }
            
            .book-genre {
                font-size: 0.6rem;
            }
            
            .book-badge {
                font-size: 0.46rem;
                padding: 0.16rem 0.3rem;
            }
            
            .book-status-badge {
                font-size: 0.4rem;
                padding: 0.16rem 0.25rem;
                max-width: 50px;
                top: 32px;
            }
            
            .bottom-nav {
                height: 58px;
            }
            
            .nav-icon {
                font-size: 1rem;
            }
            
            .nav-text {
                font-size: 0.58rem;
            }
            
            .borrowed-badge {
                font-size: 0.45rem;
                width: 14px;
                height: 14px;
                top: -1px;
            }

            .mobile-table-row {
                padding: 0.5rem;
            }

            .mobile-table-label {
                min-width: 60px;
                font-size: 0.65rem;
            }

            .mobile-table-value {
                font-size: 0.7rem;
            }
        }

        /* ====== TOUCH OPTIMIZATIONS ====== */
        @media (hover: none) {
            button:hover {
                transform: none !important;
            }
            
            .book-card:hover {
                transform: none !important;
            }
            
            .genre-item:hover {
                transform: none !important;
                background: var(--light-color) !important;
                color: var(--text-color) !important;
            }
            
            body.dark-mode .genre-item:hover {
                background: #0f172a !important;
                color: var(--dark-text) !important;
            }
            
            .genre-item.active:hover {
                background: var(--secondary-color) !important;
                color: white !important;
            }
            
            .nav-item:hover {
                transform: none !important;
            }
            
            button, 
            .book-card,
            .genre-item,
            .action-btn,
            .nav-item {
                min-height: 44px;
            }
            
            .genre-item {
                padding: 0.8rem 0.5rem;
            }
        }

        /* ====== FIX FOR MOBILE INPUT ZOOM ====== */
        @media screen and (max-width: 767px) {
            input,
            select,
            textarea {
                font-size: 16px !important;
            }
            
            .search-box input {
                font-size: 16px !important;
            }
        }

        /* ====== FIX FOR MODAL SCROLL ====== */
        .modal-content {
            -webkit-overflow-scrolling: touch;
        }

        /* ====== FIX FOR BUTTON TAP HIGHLIGHT ====== */
        button {
            -webkit-tap-highlight-color: transparent;
        }

        /* ====== FIX FOR TABLE DISPLAY ON MOBILE ====== */
        @media (max-width: 767px) {
            .admin-table th,
            .admin-table td {
                padding: 0.6rem 0.4rem;
                font-size: 0.8rem;
            }
            
            /* مخفی کردن ستون‌های اضافی در موبایل برای جدول اصلی */
            .admin-table th:nth-child(1),
            .admin-table td:nth-child(1),
            .admin-table th:nth-child(6),
            .admin-table td:nth-child(6),
            .admin-table th:nth-child(7),
            .admin-table td:nth-child(7),
            .admin-table th:nth-child(8),
            .admin-table td:nth-child(8) {
                display: none;
            }
        }

        @media (max-width: 480px) {
            .admin-table th:nth-child(3),
            .admin-table td:nth-child(3),
            .admin-table th:nth-child(4),
            .admin-table td:nth-child(4) {
                display: none;
            }
        }

        /* ====== باشترکردنی فۆنتەکان لەسەر مۆبایل ====== */
        @media (max-width: 767px) {
            body {
                font-size: 14px;
            }
            
            .book-title,
            .book-genre,
            .stat-label {
                -webkit-text-size-adjust: 100%;
            }
        }

        /* ====== NEW STYLES FOR RESPONSIVE TABLES ====== */
        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .table-actions {
            display: flex;
            gap: 0.5rem;
        }

        .table-search-box {
            position: relative;
            width: 100%;
            max-width: 300px;
        }

        .table-search-box input {
            width: 100%;
            padding: 0.6rem 1rem;
            padding-right: 2.5rem;
            border: 1px solid var(--gray-color);
            border-radius: 8px;
            font-size: 0.85rem;
        }

        body.dark-mode .table-search-box input {
            background: #0f172a;
            border-color: var(--dark-border);
            color: var(--dark-text);
        }

        .table-search-box i {
            position: absolute;
            right: 0.8rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--secondary-color);
        }

        /* ====== BOOK CARD IN ADMIN PANEL ====== */
        .admin-book-card {
            background: white;
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        body.dark-mode .admin-book-card {
            background: var(--dark-card);
        }

        .admin-book-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }

        .book-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.8rem;
        }

        .book-card-title {
            font-weight: 600;
            font-size: 0.95rem;
            color: var(--dark-color);
            margin-bottom: 0.3rem;
        }

        body.dark-mode .book-card-title {
            color: var(--dark-text);
        }

        .book-card-author {
            font-size: 0.8rem;
            color: var(--secondary-color);
        }

        body.dark-mode .book-card-author {
            color: var(--dark-primary);
        }

        .book-card-genre {
            display: inline-block;
            background: var(--accent-color);
            color: var(--dark-color);
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 500;
            margin-top: 0.3rem;
        }

        .book-card-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
            margin-bottom: 0.8rem;
            font-size: 0.8rem;
        }

        .book-card-detail {
            display: flex;
            flex-direction: column;
        }

        .detail-label {
            font-weight: 600;
            color: #666;
            font-size: 0.75rem;
            margin-bottom: 0.2rem;
        }

        body.dark-mode .detail-label {
            color: #cbd5e1;
        }

        .detail-value {
            color: var(--text-color);
        }

        body.dark-mode .detail-value {
            color: var(--dark-text);
        }

        /* ====== STUDENT REQUEST CARD ====== */
        .student-request-card {
            background: white;
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border-right: 4px solid var(--primary-color);
        }

        body.dark-mode .student-request-card {
            background: var(--dark-card);
            border-right-color: var(--dark-primary);
        }

        .student-request-card.pending {
            border-right-color: #ED8936;
        }

        .student-request-card.approved {
            border-right-color: #38B2AC;
        }

        .student-request-card.returned {
            border-right-color: #718096;
        }

        .student-request-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }

        .request-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.8rem;
        }

        .request-student-name {
            font-weight: 600;
            font-size: 0.95rem;
            color: var(--dark-color);
        }

        body.dark-mode .request-student-name {
            color: var(--dark-text);
        }

        .request-status-badge {
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            white-space: nowrap;
        }

        .request-card-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
            margin-bottom: 0.8rem;
            font-size: 0.8rem;
        }

        .request-book-title {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 0.3rem;
        }

        body.dark-mode .request-book-title {
            color: var(--dark-primary);
        }

        .request-date {
            font-size: 0.75rem;
            color: #666;
        }

        body.dark-mode .request-date {
            color: #cbd5e1;
        }
    </style>
</head>
<body>
    <!-- Bottom Navigation Bar -->
    <nav class="bottom-nav">
        <a href="#" class="nav-item" id="navDarkMode">
            <div class="nav-icon">
                <i class="fas fa-moon" id="darkModeIcon"></i>
            </div>
            <div class="nav-text">داڕک مۆد</div>
        </a>
        
        <a href="#" class="nav-item" id="navWishlist">
            <div class="nav-icon">
                <i class="fas fa-heart"></i>
                <span class="borrowed-badge" id="navWishlistCount">0</span>
            </div>
            <div class="nav-text">دڵخوازەکانم</div>
        </a>
        
        <a href="#" class="nav-item" id="navBorrowed">
            <div class="nav-icon">
                <i class="fas fa-book-reader"></i>
                <span class="borrowed-badge" id="navBorrowedCount">0</span>
            </div>
            <div class="nav-text">وەرگیراوەکان</div>
        </a>
    </nav>

    <!-- لیستی دڵخوازەکان -->
    <div class="wishlist-sidebar" id="wishlistSidebar">
        <div class="wishlist-header">
            <h3><i class="fas fa-heart"></i> لیستی دڵخوازەکانم</h3>
            <button class="close-wishlist" id="closeWishlist">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="wishlist-content" id="wishlistContent">
            <div class="wishlist-empty" id="emptyWishlist">
                <i class="fas fa-heart-broken"></i>
                <h3>لیستی دڵخوازەکانت بەتاڵە</h3>
                <p>کتێبەکانی خۆزەشت کلیکی "❤️" بکە بۆ زیادکردنیان</p>
            </div>
        </div>
    </div>

    <!-- لیستی وەرگیراوەکان -->
    <div class="borrowed-sidebar" id="borrowedSidebar">
        <div class="borrowed-header">
            <h3><i class="fas fa-book-reader"></i> وەرگیراوەکان</h3>
            <button class="close-borrowed" id="closeBorrowed">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="borrowed-content" id="borrowedContent">
            <div class="borrowed-empty" id="emptyBorrowed">
                <i class="fas fa-book"></i>
                <h3>هیچ کتێبێک وەرتنەگرتووە</h3>
                <p>کتێبێک داوا بکە و چاوەڕوانی پەسەندکردنی ئەدمین بە</p>
            </div>
        </div>
    </div>

    <header>
        <div class="logo">
            <h1>
                <span>کتێبخانەی کۆلێژی تەکنیکی شەقڵاوە</span>
                <span class="welcome-text">سەرچاوەی زانست و زانیاری</span>
            </h1>
        </div>
        <button class="admin-login-btn" id="adminLoginBtn">
            <i class="fas fa-user-shield"></i> ئەدمین
        </button>
    </header>

    <!-- پەڕەی سەرەکی (بەشی کتێبەکان) -->
    <div class="container" id="mainPage">
        <section class="search-section">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="گەڕان بۆ کتێب، نووسەر، یان بەش...">
                <i class="fas fa-search"></i>
                <div class="search-suggestions" id="searchSuggestions"></div>
            </div>
            
            <div class="genre-section">
                <button class="genre-btn" id="genreToggleBtn">
                    <i class="fas fa-filter"></i> فیلتەر بە ژانەر
                </button>
                <div class="genre-list" id="genreList">
                    <div class="genre-item active" data-genre="all">📚 هەموو کتێبەکان</div>
                    <div class="genre-item" data-genre="مێژوو">📜 مێژوو</div>
                    <div class="genre-item" data-genre="ڕۆمان">📖 ڕۆمان</div>
                    <div class="genre-item" data-genre="ئاینی">🕌 ئاینی</div>
                    <div class="genre-item" data-genre="سیاسی">🏛️ سیاسی</div>
                    <div class="genre-item" data-genre="خۆشەویستی">💖 خۆشەویستی</div>
                    <div class="genre-item" data-genre="فێرکاری زمان">🗣️ فێرکاری زمان</div>
                    <div class="genre-item" data-genre="فێرکاری تەکنەلۆژیا">💻 فێرکاری تەکنەلۆژیا</div>
                    <div class="genre-item" data-genre="ترسناک">👻 ترسناک</div>
                    <div class="genre-item" data-genre="زانستی">🔬 زانستی</div>
                    <div class="genre-item" data-genre="فەلسەفە">🧠 فەلسەفە</div>
                    <div class="genre-item" data-genre="هونەری">🎨 هونەری</div>
                    <div class="genre-item" data-genre="تەندروستی">🏥 تەندروستی</div>
                </div>
            </div>
        </section>

        <section class="books-section">
            <div class="section-header">
                <h2 id="booksSectionTitle">کتێبە نوێیەکان</h2>
                <p>دۆزینەوەی کتێبی دلخوازەکانت لە کتێبخانەی سەردەمیمان</p>
            </div>
            
            <!-- ئامارەکان - 1 rows 3 colom -->
            <div class="stats-container" id="statsContainer">
                <div class="stat-card">
                    <div class="stat-number" id="totalBooks">0</div>
                    <div class="stat-label">کۆی کتێبەکان</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="borrowedBooks">0</div>
                    <div class="stat-label">کتێبە وەرگیراوەکان</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="wishlistTotal">0</div>
                    <div class="stat-label">کتێب لە لیستی من</div>
                </div>
            </div>

            <div class="books-grid" id="booksGrid">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>بارکردنی کتێبەکان...</p>
                </div>
            </div>
        </section>
    </div>

    <!-- پەڕەی تۆمارکردنی داواکاری کتێب -->
    <div class="container" id="registrationPage" style="display: none;">
        <div class="section-header">
            <h2>📝 تۆمارکردنی داواکاری کتێب</h2>
            <p>زانیاریەکانت پڕ بکە بۆ داواکردنی کتێب</p>
        </div>
        
        <div style="max-width: 600px; margin: 0 auto; padding: 1rem;">
            <div style="background: white; padding: 1.5rem; border-radius: 12px; box-shadow: var(--shadow);">
                <form id="studentRegistrationForm">
                    <div class="form-group">
                        <label for="regStudentName"><i class="fas fa-user"></i> ناوی سیانی</label>
                        <input type="text" id="regStudentName" placeholder="ناوی تەواوی خۆت بنووسە" required>
                    </div>
                    <div class="form-group">
                        <label for="regDepartment"><i class="fas fa-building"></i> ناوی بەش</label>
                        <input type="text" id="regDepartment" placeholder="ناوی بەشی خوێندن" required>
                    </div>
                    <div class="form-group">
                        <label for="regStage"><i class="fas fa-graduation-cap"></i> قۆناغی خوێندن</label>
                        <select id="regStage" required>
                            <option value="">-- قۆناغ هەڵبژێرە --</option>
                            <option value="یەکەم">یەکەم</option>
                            <option value="دووەم">دووەم</option>
                            <option value="سێیەم">سێیەم</option>
                            <option value="چوارەم">چوارەم</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="regPhoneNumber"><i class="fas fa-phone"></i> ژمارەی مۆبایل</label>
                        <input type="tel" id="regPhoneNumber" placeholder="0750 398 3598" required>
                    </div>
                    
                    <div class="form-buttons">
                        <button type="submit" class="submit-btn">
                            <i class="fas fa-paper-plane"></i> ناردنی داواکاری
                        </button>
                        <button type="button" class="cancel-btn" id="backToMainPageBtn">
                            <i class="fas fa-arrow-left"></i> گەڕانەوە بۆ پەڕەی سەرەکی
                        </button>
                    </div>
                </form>
                
                <div id="confirmationMessage" style="display: none; background: #D1FAE5; color: #065F46; padding: 1rem; border-radius: 8px; margin-top: 1.5rem; border-right: 4px solid #10B981;">
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-check-circle" style="font-size: 1.2rem;"></i>
                        <div>
                            <h4 style="margin: 0 0 0.3rem 0;">✅ داواکاریەکەت بە سەرکەوتوویی نێردرا!</h4>
                            <p style="margin: 0; font-size: 0.9rem;">چاوەڕوانی پەسەندکردنی ئەدمین بە</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal" id="bookDetailsModal">
        <div class="modal-content">
            <span class="close-modal" id="closeBookModal">&times;</span>
            <div class="book-details" id="bookDetailsContent"></div>
        </div>
    </div>

    <div class="modal" id="adminLoginModal">
        <div class="modal-content">
            <span class="close-modal" id="closeLoginModal">&times;</span>
            <h2>🔐 چوونە ژوورەوەی ئەدمین</h2>
            <form id="adminLoginForm">
                <div class="form-group">
                    <label for="adminUsername"><i class="fas fa-user-circle"></i> ناوی بەکارهێنەر</label>
                    <input type="text" id="adminUsername" placeholder="ناوی بەکارهێنەر بنووسە" required>
                </div>
                <div class="form-group">
                    <label for="adminPassword"><i class="fas fa-lock"></i> وشەی نهێنی</label>
                    <input type="password" id="adminPassword" placeholder="وشەی نهێنی بنووسە" required>
                </div>
                <div class="error-message" id="loginError" style="display: none;">
                    <i class="fas fa-exclamation-triangle"></i> ناوی بەکارهێنەر یان وشەی نهێنی هەڵەیە
                </div>
                <div class="form-buttons">
                    <button type="submit" class="submit-btn">
                        <i class="fas fa-sign-in-alt"></i> چوونە ژوورەوە
                    </button>
                    <button type="button" class="cancel-btn" id="cancelLoginBtn">
                        <i class="fas fa-times"></i> هەڵوەشاندنەوە
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Admin Panel -->
    <div class="container" id="adminPanel" style="display: none;">
        <div class="section-header">
            <h2>⚙️ پەڕەی بەڕێوەبردنی ئەدمین</h2>
            <p>بەڕێوەبردنی کتێبەکان و داواکاریەکانی خوێندکاران</p>
        </div>
        
        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-number" id="adminTotalBooks">0</div>
                <div class="stat-label">کۆی کتێبەکان</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="adminPendingRequests">0</div>
                <div class="stat-label">داواکاری چاوەڕوان</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="adminApprovedRequests">0</div>
                <div class="stat-label">کتێبە وەرگیراوەکان</div>
            </div>
        </div>
        
        <div class="admin-actions">
            <button class="admin-action-btn" id="addBookBtn">
                <i class="fas fa-plus-circle"></i> زیادکردنی کتێبی نوێ
            </button>
            <button class="admin-action-btn" id="viewRegisteredStudentsBtn">
                <i class="fas fa-users-cog"></i> خوێندکارە داواکارەکان
            </button>
            <button class="admin-action-btn secondary" id="viewBooksBtn">
                <i class="fas fa-book"></i> بینینی کتێبەکان
            </button>
            <button class="admin-action-btn danger" id="backToMainBtn">
                <i class="fas fa-arrow-left"></i> گەڕانەوە بۆ پەڕەی سەرەکی
            </button>
        </div>

        <div id="bookManagementSection">
            <div class="section-header" style="margin-bottom: 1.2rem;">
                <h3>📚 بەڕێوەبردنی کتێبەکان</h3>
            </div>
            
            <div class="table-header">
                <div class="table-search-box">
                    <input type="text" id="adminSearchInput" placeholder="گەڕان بۆ کتێب...">
                    <i class="fas fa-search"></i>
                    <div class="search-suggestions" id="adminSearchSuggestions"></div>
                </div>
            </div>
            
            <div class="admin-table-container">
                <!-- جدول اصلی برای دسکتاپ -->
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>وێنە</th>
                            <th>ناوی کتێب</th>
                            <th>نووسەر</th>
                            <th>ژانەر</th>
                            <th>بارودۆخ</th>
                            <th>کردارەکان</th>
                        </tr>
                    </thead>
                    <tbody id="adminBooksTable"></tbody>
                </table>
                
                <!-- نمایش ریسپانسیو برای موبایل -->
                <div class="mobile-friendly-table" id="mobileAdminBooksTable"></div>
            </div>
        </div>

        <div id="registeredStudentsSection" style="display: none;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.2rem;">
                <div class="section-header" style="margin: 0;">
                    <h3>👥 خوێندکارە داواکارەکان</h3>
                </div>
                <div class="tabs">
                    <button class="tab-btn active" id="showPendingBtn">
                        <i class="fas fa-clock"></i> چاوەڕوان
                    </button>
                    <button class="tab-btn" id="showApprovedBtn">
                        <i class="fas fa-check-circle"></i> وەرگیراوەکان
                    </button>
                    <button class="tab-btn" id="showReturnedBtn">
                        <i class="fas fa-undo-alt"></i> گەڕێندراوەکان
                    </button>
                </div>
            </div>
            
            <div class="table-header">
                <div class="table-search-box">
                    <input type="text" id="studentSearchInput" placeholder="گەڕان بۆ خوێندکار...">
                    <i class="fas fa-search"></i>
                    <div class="search-suggestions" id="studentSearchSuggestions"></div>
                </div>
            </div>
            
            <div class="admin-table-container">
                <!-- جدول اصلی برای دسکتاپ -->
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>ناوی سیانی</th>
                            <th>بەش</th>
                            <th>قۆناغ</th>
                            <th>مۆبایل</th>
                            <th>کتێب</th>
                            <th>بەرواری داواکردن</th>
                            <th>بارودۆخ</th>
                            <th>کردارەکان</th>
                        </tr>
                    </thead>
                    <tbody id="registeredStudentsTable"></tbody>
                </table>
                
                <!-- نمایش ریسپانسیو برای موبایل -->
                <div class="mobile-friendly-table" id="mobileRegisteredStudentsTable"></div>
            </div>
        </div>
    </div>

    <div class="modal" id="bookFormModal">
        <div class="modal-content">
            <span class="close-modal" id="closeBookFormModal">&times;</span>
            <h2 id="bookFormTitle">📖 زیادکردنی کتێبی نوێ</h2>
            <form id="bookForm">
                <div class="form-group">
                    <label for="bookTitle"><i class="fas fa-heading"></i> ناوی کتێب</label>
                    <input type="text" id="bookTitle" placeholder="ناوی کتێب بنووسە" required>
                </div>
                <div class="form-group">
                    <label for="bookAuthor"><i class="fas fa-user-edit"></i> ناوی نووسەر</label>
                    <input type="text" id="bookAuthor" placeholder="ناوی نووسەر بنووسە" required>
                </div>
                <div class="form-group">
                    <label for="bookGenre"><i class="fas fa-tags"></i> ژانەری کتێب</label>
                    <select id="bookGenre" required>
                        <option value="">-- ژانەر هەڵبژێرە --</option>
                        <option value="مێژوو">مێژوو</option>
                        <option value="ڕۆمان">ڕۆمان</option>
                        <option value="ئاینی">ئاینی</option>
                        <option value="سیاسی">سیاسی</option>
                        <option value="خۆشەویستی">خۆشەویستی</option>
                        <option value="فێرکاری زمان">فێرکاری زمان</option>
                        <option value="فێرکاری تەکنەلۆژیا">فێرکاری تەکنەلۆژیا</option>
                        <option value="ترسناک">ترسناک</option>
                        <option value="زانستی">زانستی</option>
                        <option value="فەلسەفە">فەلسەفە</option>
                        <option value="هونەری">هونەری</option>
                        <option value="تەندروستی">تەندروستی</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="bookSummary"><i class="fas fa-align-left"></i> کورتەی کتێب</label>
                    <textarea id="bookSummary" rows="4" placeholder="کورتەیەک دەربارەی ناوەڕۆکی کتێبەکە بنووسە..." required></textarea>
                </div>
                <div class="form-group">
                    <label for="bookImage"><i class="fas fa-image"></i> لینکی وێنەی کتێب</label>
                    <input type="text" id="bookImage" placeholder="لینکی وێنە (URL)" required>
                </div>
                <input type="hidden" id="bookId">
                <div class="form-buttons">
                    <button type="submit" class="submit-btn" id="bookFormSubmitBtn">
                        <i class="fas fa-save"></i> پاشەکەوت
                    </button>
                    <button type="button" class="cancel-btn" id="cancelBookFormBtn">
                        <i class="fas fa-times"></i> هەڵوەشاندنەوە
                    </button>
                </div>
            </form>
        </div>
    </div>

    <footer>
        <div class="footer-content">
            <h3 style="color: white; margin-bottom: 0.8rem; font-size: 1.1rem;">کتێبخانەی کۆلێژی تەکنیکی شەقڵاوە</h3>
            <p><i class="fas fa-map-marker-alt"></i> شەقڵاوە، کۆلێژی تەکنیکی شەقڵاوە</p>
            <p><i class="fas fa-envelope"></i> zheargaylan2017@gmail.com</p>
            <p><i class="fas fa-phone"></i> 0750 398 3598</p>
            <div style="margin-top: 1.2rem; padding-top: 0.8rem; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                <p>© 2026 کتێبخانەی کۆلێژی تەکنیکی شەقڵاوە. هەموو مافەکان پارێزراون.</p>
                <p style="color: #CBD5E0; font-size: 0.8rem; margin-top: 0.5rem;">
                    <i class="fas fa-heart" style="color: #F56565;"></i> دروستکراوە بە خۆشەویستی بۆ خوێندکارانی کوردستان
                </p>
            </div>
        </div>
    </footer>

    <script type="module">
        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-analytics.js";
        import { 
            getFirestore, 
            collection, 
            addDoc, 
            getDocs, 
            deleteDoc, 
            doc, 
            updateDoc, 
            query, 
            where,
            serverTimestamp 
        } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDldHXuM8uPbgOT-hxRHk5e7YnSkKn0pHI",
            authDomain: "lanuage-slahaddin.firebaseapp.com",
            projectId: "lanuage-slahaddin",
            storageBucket: "lanuage-slahaddin.firebasestorage.app",
            messagingSenderId: "887991955360",
            appId: "1:887991955360:web:e23481e92a29e91578fec5",
            measurementId: "G-GWLZDH54WL"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const db = getFirestore(app);

        // DOM Elements
        const navDarkMode = document.getElementById('navDarkMode');
        const darkModeIcon = document.getElementById('darkModeIcon');
        const navWishlist = document.getElementById('navWishlist');
        const navBorrowed = document.getElementById('navBorrowed');
        const navWishlistCount = document.getElementById('navWishlistCount');
        const navBorrowedCount = document.getElementById('navBorrowedCount');
        
        const wishlistSidebar = document.getElementById('wishlistSidebar');
        const closeWishlist = document.getElementById('closeWishlist');
        const wishlistContent = document.getElementById('wishlistContent');
        const emptyWishlist = document.getElementById('emptyWishlist');
        
        const borrowedSidebar = document.getElementById('borrowedSidebar');
        const closeBorrowed = document.getElementById('closeBorrowed');
        const borrowedContent = document.getElementById('borrowedContent');
        const emptyBorrowed = document.getElementById('emptyBorrowed');

        // DOM Elements
        const adminLoginBtn = document.getElementById('adminLoginBtn');
        const adminLoginModal = document.getElementById('adminLoginModal');
        const closeLoginModal = document.getElementById('closeLoginModal');
        const cancelLoginBtn = document.getElementById('cancelLoginBtn');
        const adminLoginForm = document.getElementById('adminLoginForm');
        const loginError = document.getElementById('loginError');
        
        const adminPanel = document.getElementById('adminPanel');
        const backToMainBtn = document.getElementById('backToMainBtn');
        const viewBooksBtn = document.getElementById('viewBooksBtn');
        
        const genreToggleBtn = document.getElementById('genreToggleBtn');
        const genreList = document.getElementById('genreList');
        const searchInput = document.getElementById('searchInput');
        const searchSuggestions = document.getElementById('searchSuggestions');
        
        const booksGrid = document.getElementById('booksGrid');
        const booksSectionTitle = document.getElementById('booksSectionTitle');
        const statsContainer = document.getElementById('statsContainer');
        
        const bookDetailsModal = document.getElementById('bookDetailsModal');
        const closeBookModal = document.getElementById('closeBookModal');
        
        const registrationPage = document.getElementById('registrationPage');
        const mainPage = document.getElementById('mainPage');
        const studentRegistrationForm = document.getElementById('studentRegistrationForm');
        const backToMainPageBtn = document.getElementById('backToMainPageBtn');
        const confirmationMessage = document.getElementById('confirmationMessage');
        
        const bookFormModal = document.getElementById('bookFormModal');
        const closeBookFormModal = document.getElementById('closeBookFormModal');
        const cancelBookFormBtn = document.getElementById('cancelBookFormBtn');
        const bookForm = document.getElementById('bookForm');
        const bookFormTitle = document.getElementById('bookFormTitle');
        const bookFormSubmitBtn = document.getElementById('bookFormSubmitBtn');
        
        const addBookBtn = document.getElementById('addBookBtn');
        const viewRegisteredStudentsBtn = document.getElementById('viewRegisteredStudentsBtn');
        const showPendingBtn = document.getElementById('showPendingBtn');
        const showApprovedBtn = document.getElementById('showApprovedBtn');
        const showReturnedBtn = document.getElementById('showReturnedBtn');
        
        const bookManagementSection = document.getElementById('bookManagementSection');
        const registeredStudentsSection = document.getElementById('registeredStudentsSection');
        
        const adminBooksTable = document.getElementById('adminBooksTable');
        const mobileAdminBooksTable = document.getElementById('mobileAdminBooksTable');
        const registeredStudentsTable = document.getElementById('registeredStudentsTable');
        const mobileRegisteredStudentsTable = document.getElementById('mobileRegisteredStudentsTable');
        const adminSearchInput = document.getElementById('adminSearchInput');
        const adminSearchSuggestions = document.getElementById('adminSearchSuggestions');
        const studentSearchInput = document.getElementById('studentSearchInput');
        const studentSearchSuggestions = document.getElementById('studentSearchSuggestions');

        // Application State
        let currentUser = null;
        let books = [];
        let allRequests = [];
        let approvedRequests = [];
        let wishlist = [];
        let currentGenre = 'all';
        let currentSearch = '';
        let editingBookId = null;
        let currentStudentView = 'pending';
        let currentSelectedBook = null;

        // Admin Credentials
        const ADMIN_USERNAME = '1981Language2026';
        const ADMIN_PASSWORD = 'S1981S';

        // Status Types
        const STATUS = {
            PENDING: 'pending',
            APPROVED: 'approved',
            RETURNED: 'returned',
            REJECTED: 'rejected'
        };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', async function() {
            setupEventListeners();
            loadWishlistFromLocalStorage();
            await loadBooksFromFirebase();
            await loadAllRequestsFromFirebase();
            displayBooks();
            updateWishlistCount();
            updateWishlistUI();
            updateBorrowedBooksUI();
            
            // Update badges
            setTimeout(() => {
                navWishlistCount.textContent = wishlist.length || 0;
                navBorrowedCount.textContent = approvedRequests.length || 0;
            }, 500);
        });

        // Set up event listeners
        function setupEventListeners() {
            // Bottom Navigation
            navDarkMode.addEventListener('click', (e) => {
                e.preventDefault();
                toggleDarkMode();
            });
            
            navWishlist.addEventListener('click', (e) => {
                e.preventDefault();
                wishlistSidebar.classList.add('active');
            });
            
            navBorrowed.addEventListener('click', (e) => {
                e.preventDefault();
                borrowedSidebar.classList.add('active');
                updateBorrowedBooksUI();
            });
            
            closeWishlist.addEventListener('click', () => {
                wishlistSidebar.classList.remove('active');
            });
            
            closeBorrowed.addEventListener('click', () => {
                borrowedSidebar.classList.remove('active');
            });
            
            // Admin login
            adminLoginBtn.addEventListener('click', () => {
                adminLoginModal.classList.add('active');
            });
            
            closeLoginModal.addEventListener('click', () => {
                adminLoginModal.classList.remove('active');
                loginError.style.display = 'none';
            });
            
            cancelLoginBtn.addEventListener('click', () => {
                adminLoginModal.classList.remove('active');
                loginError.style.display = 'none';
            });
            
            adminLoginForm.addEventListener('submit', handleAdminLogin);
            
            // Genre toggle
            genreToggleBtn.addEventListener('click', () => {
                genreList.classList.toggle('active');
            });
            
            // Genre selection
            document.querySelectorAll('.genre-item').forEach(item => {
                item.addEventListener('click', () => {
                    document.querySelectorAll('.genre-item').forEach(i => i.classList.remove('active'));
                    item.classList.add('active');
                    currentGenre = item.getAttribute('data-genre');
                    booksSectionTitle.textContent = currentGenre === 'all' ? 'کتێبە نوێیەکان' : `کتێبەکانی ${currentGenre}`;
                    genreList.classList.remove('active');
                    displayBooks();
                });
            });
            
            // Search functionality
            searchInput.addEventListener('input', (e) => {
                currentSearch = e.target.value.toLowerCase();
                
                if (currentSearch.trim() !== '') {
                    showSearchSuggestions(currentSearch, searchSuggestions);
                } else {
                    searchSuggestions.classList.remove('active');
                }
                
                displayBooks();
            });
            
            // کلیک دەرەوە بۆ داخستنی پێشنیارەکان
            document.addEventListener('click', (e) => {
                if (!searchSuggestions.contains(e.target) && e.target !== searchInput) {
                    searchSuggestions.classList.remove('active');
                }
                if (!adminSearchSuggestions.contains(e.target) && e.target !== adminSearchInput) {
                    adminSearchSuggestions.classList.remove('active');
                }
                if (!studentSearchSuggestions.contains(e.target) && e.target !== studentSearchInput) {
                    studentSearchSuggestions.classList.remove('active');
                }
                if (!wishlistSidebar.contains(e.target) && e.target !== navWishlist && !navWishlist.contains(e.target)) {
                    wishlistSidebar.classList.remove('active');
                }
                if (!borrowedSidebar.contains(e.target) && e.target !== navBorrowed && !navBorrowed.contains(e.target)) {
                    borrowedSidebar.classList.remove('active');
                }
            });
            
            // Close modals
            closeBookModal.addEventListener('click', () => {
                bookDetailsModal.classList.remove('active');
            });
            
            closeBookFormModal.addEventListener('click', () => {
                bookFormModal.classList.remove('active');
                resetBookForm();
            });
            
            // Back to main page from registration
            backToMainPageBtn.addEventListener('click', () => {
                goToMainPage();
            });
            
            cancelBookFormBtn.addEventListener('click', () => {
                bookFormModal.classList.remove('active');
                resetBookForm();
            });
            
            // Student registration form submission
            studentRegistrationForm.addEventListener('submit', handleStudentRegistration);
            
            // Book form submission
            bookForm.addEventListener('submit', handleBookFormSubmit);
            
            // Admin panel navigation
            backToMainBtn.addEventListener('click', () => {
                adminPanel.style.display = 'none';
                mainPage.style.display = 'block';
            });
            
            viewBooksBtn.addEventListener('click', () => {
                bookManagementSection.style.display = 'block';
                registeredStudentsSection.style.display = 'none';
                displayAdminBooks();
            });
            
            addBookBtn.addEventListener('click', () => {
                showBookForm();
            });
            
            viewRegisteredStudentsBtn.addEventListener('click', async () => {
                bookManagementSection.style.display = 'none';
                registeredStudentsSection.style.display = 'block';
                currentStudentView = 'pending';
                updateStudentViewButtons();
                await displayRegisteredStudentsFromFirebase();
            });
            
            // Student view toggle buttons
            showPendingBtn.addEventListener('click', async () => {
                document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                showPendingBtn.classList.add('active');
                currentStudentView = 'pending';
                await displayRegisteredStudentsFromFirebase();
            });
            
            showApprovedBtn.addEventListener('click', async () => {
                document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                showApprovedBtn.classList.add('active');
                currentStudentView = 'approved';
                await displayRegisteredStudentsFromFirebase();
            });
            
            showReturnedBtn.addEventListener('click', async () => {
                document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                showReturnedBtn.classList.add('active');
                currentStudentView = 'returned';
                await displayRegisteredStudentsFromFirebase();
            });
            
            // Admin search
            adminSearchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                
                if (searchTerm.trim() !== '') {
                    showSearchSuggestions(searchTerm, adminSearchSuggestions);
                } else {
                    adminSearchSuggestions.classList.remove('active');
                }
                
                displayAdminBooks(searchTerm);
            });
            
            // Student search
            studentSearchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                
                if (searchTerm.trim() !== '') {
                    showStudentSearchSuggestions(searchTerm);
                } else {
                    studentSearchSuggestions.classList.remove('active');
                }
                
                displayRegisteredStudents(searchTerm);
            });
        }

        // داڕک مۆد تووگڵ
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            
            if (document.body.classList.contains('dark-mode')) {
                localStorage.setItem('darkMode', 'enabled');
                darkModeIcon.className = 'fas fa-sun';
                showNotification('🌙 داڕک مۆد چالاککرا', 'success');
            } else {
                localStorage.setItem('darkMode', 'disabled');
                darkModeIcon.className = 'fas fa-moon';
                showNotification('☀️ ڕووناک مۆد چالاککرا', 'success');
            }
        }

        // بارکردنی هەڵبژاردەی پێشوو
        if (localStorage.getItem('darkMode') === 'enabled') {
            document.body.classList.add('dark-mode');
            darkModeIcon.className = 'fas fa-sun';
        }

        // گەڕان بۆ پەڕەی سەرەکی
        function goToMainPage() {
            mainPage.style.display = 'block';
            registrationPage.style.display = 'none';
            adminPanel.style.display = 'none';
            resetRegistrationForm();
            currentSelectedBook = null;
        }

        // گەڕان بۆ پەڕەی تۆمارکردن
        function goToRegistrationPage(book = null) {
            mainPage.style.display = 'none';
            registrationPage.style.display = 'block';
            adminPanel.style.display = 'none';
            resetRegistrationForm();
            currentSelectedBook = book;
        }

        // پاککردنەوەی فۆڕمی تۆمارکردن
        function resetRegistrationForm() {
            studentRegistrationForm.reset();
            confirmationMessage.style.display = 'none';
        }

        // Load books from Firebase
        async function loadBooksFromFirebase() {
            try {
                const querySnapshot = await getDocs(collection(db, "Slahaddin"));
                books = [];
                querySnapshot.forEach((doc) => {
                    const bookData = doc.data();
                    books.push({
                        id: doc.id,
                        naw: bookData.name || bookData.naw || "بێ ناو",
                        author: bookData.authorName || bookData.author || "نەناسراو",
                        zhanar: bookData.genre || bookData.zhanar || "هیچ",
                        kurta: bookData.summary || bookData.kurta || "هیچ کورتەیەک نیە",
                        linkewena: bookData.imgUrl || bookData.linkewena || "https://images.unsplash.com/photo-1544716278-ca5e3f4abd8c?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80",
                        createdAt: bookData.createdAt || new Date().toISOString()
                    });
                });
                
                console.log(`Loaded ${books.length} books from Firebase`);
                if (books.length === 0) {
                    console.log("No books found in Firebase, adding sample books...");
                    await addSampleBooks();
                    await loadBooksFromFirebase();
                }
                
            } catch (error) {
                console.error('Error loading books from Firebase:', error);
                loadBooksFromLocalStorage();
            }
        }

        // Add sample books to Firebase
        async function addSampleBooks() {
            const sampleBooks = [
                {
                    name: "مێژووی کورد",
                    authorName: "د. کەمال مەزھەر",
                    genre: "مێژوو",
                    summary: "کتێبێکی دەقی زانستیە کە مێژووی کورد و کوردستان باس دەکات",
                    imgUrl: "https://images.unsplash.com/photo-1541963463532-d68292c34b19?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80",
                    createdAt: new Date().toISOString()
                },
                {
                    name: "ڕۆمانی شەوانی بەغدا",
                    authorName: "نووسەر نەناسراو",
                    genre: "ڕۆمان",
                    summary: "ڕۆمانێکی سەردەمی مۆدێرن کە چیرۆکەکەی لە شاری بەغدادە",
                    imgUrl: "https://images.unsplash.com/photo-1544947950-fa07a98d237f?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80",
                    createdAt: new Date().toISOString()
                },
                {
                    name: "چاوەڕێم بکە",
                    authorName: "د. عەلی کەریم",
                    genre: "خۆشەویستی",
                    summary: "ڕۆمانێکی خۆشەویستی کە چیرۆکی خۆشەویستی لە نێوان دوو خوێندکار دەگێڕێتەوە",
                    imgUrl: "https://images.unsplash.com/photo-1512820790803-83ca734da794?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80",
                    createdAt: new Date().toISOString()
                },
                {
                    name: "فێرکاری زمانی ئینگلیزی",
                    authorName: "د. سەلام ناوخۆش",
                    genre: "فێرکاری زمان",
                    summary: "کتێبێک بۆ فێربوونی زمانی ئینگلیزی بە شێوەیەکی سادە",
                    imgUrl: "https://images.unsplash.com/photo-1544716278-ca5e3f4abd8c?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80",
                    createdAt: new Date().toISOString()
                },
                {
                    name: "فەلسەفەی ڕۆژئاوایی",
                    authorName: "د. نەوزاد ئەحمەد",
                    genre: "فەلسەفە",
                    summary: "وتارێک لەسەر فەلسەفەی ڕۆژئاوایی و کاریگەریەکانی",
                    imgUrl: "https://images.unsplash.com/photo-1541963463532-d68292c34b19?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80",
                    createdAt: new Date().toISOString()
                },
                {
                    name: "هونەری نەخشەکێشان",
                    authorName: "سەلاح عەبدوڵڵا",
                    genre: "هونەری",
                    summary: "کتێبێک بۆ فێربوونی هونەری نەخشەکێشان",
                    imgUrl: "https://images.unsplash.com/photo-1544947950-fa07a98d237f?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80",
                    createdAt: new Date().toISOString()
                },
                {
                    name: "زانستی کۆمپیوتەر",
                    authorName: "ئەحمەد عەلی",
                    genre: "فێرکاری تەکنەلۆژیا",
                    summary: "کتێبێک بۆ فێربوونی زانستی کۆمپیوتەر",
                    imgUrl: "https://images.unsplash.com/photo-1544716278-ca5e3f4abd8c?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80",
                    createdAt: new Date().toISOString()
                }
            ];

            try {
                for (const book of sampleBooks) {
                    await addDoc(collection(db, "Slahaddin"), book);
                }
                console.log("Sample books added to Firebase");
            } catch (error) {
                console.error("Error adding sample books:", error);
            }
        }

        // Load all requests from Firebase
        async function loadAllRequestsFromFirebase() {
            try {
                const querySnapshot = await getDocs(collection(db, "requests"));
                allRequests = [];
                querySnapshot.forEach((doc) => {
                    const requestData = doc.data();
                    allRequests.push({
                        id: doc.id,
                        name: requestData.name || requestData.studentName || "بێ ناو",
                        department: requestData.department || "بێ بەش",
                        stage: requestData.stage || "نەزانراو",
                        number: requestData.phoneNumber || requestData.number || "نەزانراو",
                        bookTitle: requestData.bookTitle || "بێ ناو",
                        pasand: requestData.pasand || requestData.approved || false,
                        requestDate: requestData.requestDate || new Date().toISOString(),
                        returned: requestData.returned || false,
                        approvedDate: requestData.approvedDate || null,
                        returnDate: requestData.returnDate || null
                    });
                });
                
                approvedRequests = allRequests.filter(request => request.pasand === true && !request.returned);
                
                console.log(`Loaded ${allRequests.length} total requests, ${approvedRequests.length} approved requests`);
                
                updateStatistics();
                
            } catch (error) {
                console.error('Error loading requests from Firebase:', error);
                allRequests = [];
                approvedRequests = [];
            }
        }

        // Update statistics
        function updateStatistics() {
            const totalBooks = books.length;
            const wishlistCount = wishlist.length;
            const borrowedBooksCount = approvedRequests.length;
            
            document.getElementById('totalBooks').textContent = totalBooks;
            document.getElementById('wishlistTotal').textContent = wishlistCount;
            document.getElementById('borrowedBooks').textContent = borrowedBooksCount;
            
            navWishlistCount.textContent = wishlistCount;
            navBorrowedCount.textContent = borrowedBooksCount;
            
            document.getElementById('adminTotalBooks').textContent = totalBooks;
            const pendingCount = allRequests.filter(r => !r.pasand).length;
            document.getElementById('adminPendingRequests').textContent = pendingCount;
            document.getElementById('adminApprovedRequests').textContent = borrowedBooksCount;
        }

        // Check if a book is currently borrowed
        function isBookBorrowed(bookTitle) {
            return approvedRequests.some(request => 
                request.bookTitle === bookTitle && request.pasand === true && !request.returned
            );
        }

        // Check if a book has pending requests
        function hasPendingRequests(bookTitle) {
            return allRequests.some(request => 
                request.bookTitle === bookTitle && !request.pasand
            );
        }

        // لیستی وەرگیراوەکان
        function getMyBorrowedBooks() {
            return approvedRequests.filter(request => request.pasand === true && !request.returned);
        }

        // نوێکردنی لیستی وەرگیراوەکان
        function updateBorrowedBooksUI() {
            borrowedContent.innerHTML = '';
            
            const myBorrowedBooks = getMyBorrowedBooks();
            
            if (myBorrowedBooks.length === 0) {
                emptyBorrowed.style.display = 'block';
                return;
            }
            
            emptyBorrowed.style.display = 'none';
            
            myBorrowedBooks.forEach(request => {
                const book = books.find(b => b.naw === request.bookTitle);
                const requestDate = request.requestDate ? new Date(request.requestDate) : new Date();
                const daysPassed = Math.floor((new Date() - requestDate) / (1000 * 60 * 60 * 24));
                
                const borrowedItem = document.createElement('div');
                borrowedItem.className = 'borrowed-item';
                borrowedItem.innerHTML = `
                    <img src="${book?.linkewena || 'https://images.unsplash.com/photo-1544716278-ca5e3f4abd8c?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80'}" alt="${request.bookTitle}" class="borrowed-item-image">
                    <div class="borrowed-item-info">
                        <div class="borrowed-item-title">${request.bookTitle}</div>
                        <div class="borrowed-item-author">${book?.author || 'نەناسراو'}</div>
                        <div class="borrowed-item-date">بەرواری داواکردن: ${requestDate.toLocaleDateString('ku')}</div>
                        <div class="borrowed-item-date" style="color: var(--primary-color); font-weight: 600;">
                            <i class="fas fa-user"></i> وەرگر: ${request.name}
                        </div>
                        <div class="borrowed-item-status status-borrowed">
                            وەرگیراوە لە ${daysPassed} ڕۆژ پێش ئێستا
                        </div>
                    </div>
                `;
                
                borrowedContent.appendChild(borrowedItem);
            });
        }

        // Load books from local storage (fallback)
        function loadBooksFromLocalStorage() {
            const savedBooks = localStorage.getItem('libraryBooks');
            if (savedBooks) {
                books = JSON.parse(savedBooks);
                console.log(`Loaded ${books.length} books from local storage`);
            } else {
                books = [];
                console.log('No saved books found in local storage');
            }
        }

        // Display books in main page
        function displayBooks() {
            booksGrid.innerHTML = '';
            
            let filteredBooks = books;
            
            if (currentGenre !== 'all') {
                filteredBooks = filteredBooks.filter(book => book.zhanar === currentGenre);
            }
            
            if (currentSearch) {
                filteredBooks = filteredBooks.filter(book => 
                    book.naw.toLowerCase().includes(currentSearch) ||
                    (book.author && book.author.toLowerCase().includes(currentSearch)) ||
                    (book.kurta && book.kurta.toLowerCase().includes(currentSearch)) ||
                    (book.zhanar && book.zhanar.toLowerCase().includes(currentSearch))
                );
            }
            
            if (filteredBooks.length === 0) {
                booksGrid.innerHTML = '<div class="empty-state"><i class="fas fa-search"></i><h3>هیچ کتێبێک نەدۆزرایەوە</h3><p>گەڕانەکەت بگۆڕە یان ژانەرێکی تر هەڵبژێرە</p></div>';
                return;
            }
            
            filteredBooks.forEach(book => {
                const isInWishlist = wishlist.some(item => item.id === book.id);
                const isBorrowed = isBookBorrowed(book.naw);
                const hasPending = hasPendingRequests(book.naw);
                
                const bookCard = document.createElement('div');
                bookCard.className = `book-card`;
                bookCard.innerHTML = `
                    <div class="book-badge">${book.zhanar}</div>
                    ${isBorrowed ? '<div class="book-status-badge">📖 وەرگیراوە</div>' : ''}
                    ${hasPending && !isBorrowed ? '<div class="book-status-badge" style="background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);">⏳ چاوەڕوان</div>' : ''}
                    <img src="${book.linkewena || 'https://images.unsplash.com/photo-1544716278-ca5e3f4abd8c?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80'}" alt="${book.naw}" class="book-image">
                    <div class="book-info">
                        <div class="book-title">${book.naw}</div>
                        <div class="book-author"><i class="fas fa-user-edit"></i> ${book.author || 'نەناسراو'}</div>
                        <div class="book-genre"><i class="fas fa-tag"></i> ${book.zhanar}</div>
                        ${isBorrowed ? '<div style="color: var(--danger-color); font-size: 0.7rem; margin-top: 0.3rem;"><i class="fas fa-info-circle"></i> پێشتر داوا کراە</div>' : ''}
                    </div>
                `;
                
                bookCard.addEventListener('click', (e) => {
                    showBookDetails(book);
                });
                
                booksGrid.appendChild(bookCard);
            });
        }

        // Show book details modal
        function showBookDetails(book) {
            const isInWishlist = wishlist.some(item => item.id === book.id);
            const isBorrowed = isBookBorrowed(book.naw);
            const hasPending = hasPendingRequests(book.naw);
            
            const bookDetailsContent = document.getElementById('bookDetailsContent');
            bookDetailsContent.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.2rem;">
                    <h2 style="font-size: 1.3rem; margin: 0;">${book.naw}</h2>
                    <span class="badge" style="background: var(--accent-color); color: var(--dark-color); padding: 0.3rem 0.6rem; font-size: 0.75rem;">${book.zhanar}</span>
                </div>
                
                <img src="${book.linkewena || 'https://images.unsplash.com/photo-1544716278-ca5e3f4abd8c?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80'}" alt="${book.naw}" style="width: 100%; max-height: 250px; object-fit: cover; border-radius: 10px; margin-bottom: 1.2rem;">
                
                <div>
                    <div style="background: var(--light-color); padding: 1rem; border-radius: 10px; margin-bottom: 1rem;">
                        <h3 style="color: var(--primary-color); margin-bottom: 0.6rem; font-size: 1rem;"><i class="fas fa-info-circle"></i> زانیاری کتێب</h3>
                        <p style="margin-bottom: 0.4rem;"><strong>نووسەر:</strong> ${book.author || 'نەناسراو'}</p>
                        <p><strong>ژانەر:</strong> ${book.zhanar}</p>
                        ${book.createdAt ? `<p style="margin-top: 0.4rem;"><strong>بەرواری زیادکردن:</strong> ${new Date(book.createdAt).toLocaleDateString('ku')}</p>` : ''}
                    </div>
                    
                    ${book.kurta ? `
                    <div style="background: var(--light-color); padding: 1rem; border-radius: 10px; margin-bottom: 1rem;">
                        <h3 style="color: var(--primary-color); margin-bottom: 0.6rem; font-size: 1rem;"><i class="fas fa-align-left"></i> کورتە</h3>
                        <p style="line-height: 1.5; font-size: 0.9rem;">${book.kurta}</p>
                    </div>
                    ` : ''}
                    
                    ${isBorrowed ? `
                    <div style="background: #FEF3C7; padding: 1rem; border-radius: 10px; margin-bottom: 1rem; border-right: 4px solid #D97706;">
                        <h3 style="color: #92400E; margin-bottom: 0.6rem; font-size: 1rem;"><i class="fas fa-exclamation-triangle"></i> ئاگاداری</h3>
                        <p style="color: #92400E; font-size: 0.9rem;">پێشتر داوا کراە چاوەڕوان بە!</p>
                    </div>
                    ` : ''}
                    
                    ${hasPending && !isBorrowed ? `
                    <div style="background: #DBEAFE; padding: 1rem; border-radius: 10px; margin-bottom: 1rem; border-right: 4px solid #3B82F6;">
                        <h3 style="color: #1E40AF; margin-bottom: 0.6rem; font-size: 1rem;"><i class="fas fa-info-circle"></i> زانیاری</h3>
                        <p style="color: #1E40AF; font-size: 0.9rem;">ئەم کتێبە داواکاری چاوەڕوانی هەیە.</p>
                    </div>
                    ` : ''}
                    
                    <button class="wishlist-btn ${isInWishlist ? 'in-wishlist' : ''}" id="modalWishlistBtn" data-id="${book.id}" data-title="${book.naw}" data-author="${book.author || 'نەناسراو'}" data-image="${book.linkewena}" style="background: linear-gradient(135deg, #f56565 0%, #ed8936 100%); color: white; border: none; padding: 0.8rem; border-radius: 8px; cursor: pointer; font-size: 0.9rem; font-weight: 600; margin-top: 0.5rem; width: 100%; transition: var(--transition); display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                        <i class="fas fa-heart"></i> ${isInWishlist ? 'لابردنی لە لیستی دڵخوازەکان' : 'زیادکردنی بۆ لیستی دڵخوازەکان'}
                    </button>
                    
                    ${!isBorrowed ? `
                    <button class="borrow-btn" id="borrowBookBtn" data-id="${book.id}" data-title="${book.naw}" style="background: var(--gradient); color: white; border: none; padding: 0.8rem; border-radius: 8px; cursor: pointer; font-size: 0.9rem; font-weight: 600; margin-top: 0.8rem; width: 100%; transition: var(--transition); display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                        <i class="fas fa-book-reader"></i> داواکردنی کتێب
                    </button>
                    ` : ''}
                </div>
            `;
            
            bookDetailsModal.classList.add('active');
            
            document.getElementById('modalWishlistBtn').addEventListener('click', (e) => {
                const bookId = e.target.closest('button').getAttribute('data-id');
                const bookTitle = e.target.closest('button').getAttribute('data-title');
                const bookAuthor = e.target.closest('button').getAttribute('data-author');
                const bookImage = e.target.closest('button').getAttribute('data-image');
                
                toggleWishlist(bookId, bookTitle, bookAuthor, bookImage);
            });
            
            if (!isBorrowed) {
                document.getElementById('borrowBookBtn').addEventListener('click', (e) => {
                    const bookId = e.target.closest('button').getAttribute('data-id');
                    const bookTitle = e.target.closest('button').getAttribute('data-title');
                    const selectedBook = books.find(b => b.id === bookId);
                    
                    bookDetailsModal.classList.remove('active');
                    goToRegistrationPage(selectedBook);
                });
            }
        }

        // لیستی دڵخوازەکان - تووشکردن
        function toggleWishlist(bookId, bookTitle, bookAuthor, bookImage) {
            const existingIndex = wishlist.findIndex(item => item.id === bookId);
            
            if (existingIndex !== -1) {
                wishlist.splice(existingIndex, 1);
                showNotification('📖 کتێبەکە لابرا لە لیستی دڵخوازەکان', 'warning');
            } else {
                wishlist.push({
                    id: bookId,
                    title: bookTitle,
                    author: bookAuthor,
                    image: bookImage,
                    addedAt: new Date().toISOString()
                });
                showNotification('❤️ کتێبەکە زیادکرا بۆ لیستی دڵخوازەکان', 'success');
            }
            
            saveWishlistToLocalStorage();
            updateWishlistUI();
            updateWishlistCount();
            displayBooks();
            updateModalWishlistButton(bookId);
        }

        // پاشەکەوتکردنی لیستی دڵخوازەکان
        function saveWishlistToLocalStorage() {
            localStorage.setItem('libraryWishlist', JSON.stringify(wishlist));
        }

        // بارکردنی لیستی دڵخوازەکان
        function loadWishlistFromLocalStorage() {
            const savedWishlist = localStorage.getItem('libraryWishlist');
            if (savedWishlist) {
                wishlist = JSON.parse(savedWishlist);
                console.log(`Loaded ${wishlist.length} items from wishlist`);
            } else {
                wishlist = [];
                console.log('No saved wishlist found, starting with empty wishlist');
            }
        }

        // نوێکردنی لیستی دڵخوازەکان
        function updateWishlistUI() {
            wishlistContent.innerHTML = '';
            
            if (wishlist.length === 0) {
                emptyWishlist.style.display = 'block';
                return;
            }
            
            emptyWishlist.style.display = 'none';
            
            wishlist.forEach(item => {
                const isBorrowed = isBookBorrowed(item.title);
                
                const wishlistItem = document.createElement('div');
                wishlistItem.className = 'wishlist-item';
                wishlistItem.innerHTML = `
                    <img src="${item.image || 'https://images.unsplash.com/photo-1544716278-ca5e3f4abd8c?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80'}" alt="${item.title}" class="wishlist-item-image">
                    <div class="wishlist-item-info">
                        <div class="wishlist-item-title">${item.title}</div>
                        <div class="wishlist-item-author">${item.author}</div>
                        ${isBorrowed ? '<div style="color: var(--danger-color); font-size: 0.7rem; margin-bottom: 0.3rem;"><i class="fas fa-info-circle"></i> پێشتر داوا کراە</div>' : ''}
                        <div class="wishlist-item-actions">
                            <button class="wishlist-remove-btn" data-id="${item.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                            ${!isBorrowed ? `<button class="wishlist-borrow-btn" data-id="${item.id}" data-title="${item.title}">
                                <i class="fas fa-book-reader"></i> داواکردن
                            </button>` : ''}
                        </div>
                    </div>
                `;
                
                wishlistContent.appendChild(wishlistItem);
            });
            
            document.querySelectorAll('.wishlist-remove-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const bookId = btn.getAttribute('data-id');
                    const bookItem = wishlist.find(item => item.id === bookId);
                    
                    if (bookItem) {
                        wishlist = wishlist.filter(item => item.id !== bookId);
                        saveWishlistToLocalStorage();
                        updateWishlistUI();
                        updateWishlistCount();
                        displayBooks();
                        updateModalWishlistButton(bookId);
                        
                        showNotification('🗑️ کتێبەکە لابرا لە لیستی دڵخوازەکان', 'warning');
                    }
                });
            });
            
            document.querySelectorAll('.wishlist-borrow-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const bookId = btn.getAttribute('data-id');
                    const bookTitle = btn.getAttribute('data-title');
                    const selectedBook = books.find(b => b.id === bookId);
                    
                    wishlistSidebar.classList.remove('active');
                    goToRegistrationPage(selectedBook);
                });
            });
        }

        // نوێکردنی دوگمەی مۆدالی وردەکاری کتێب
        function updateModalWishlistButton(bookId) {
            const modalWishlistBtn = document.getElementById('modalWishlistBtn');
            if (modalWishlistBtn && modalWishlistBtn.getAttribute('data-id') === bookId) {
                const isInWishlist = wishlist.some(item => item.id === bookId);
                modalWishlistBtn.innerHTML = `<i class="fas fa-heart"></i> ${isInWishlist ? 'لابردنی لە لیستی دڵخوازەکان' : 'زیادکردنی بۆ لیستی دڵخوازەکان'}`;
                modalWishlistBtn.classList.toggle('in-wishlist', isInWishlist);
            }
        }

        // نوێکردنی ژمارەی لیستی دڵخوازەکان
        function updateWishlistCount() {
            const count = wishlist.length;
            navWishlistCount.textContent = count;
            document.getElementById('wishlistTotal').textContent = count;
            updateStatistics();
        }

        // Display admin books with responsive design
        function displayAdminBooks(searchTerm = '') {
            adminBooksTable.innerHTML = '';
            mobileAdminBooksTable.innerHTML = '';
            
            let filteredBooks = books;
            
            if (searchTerm) {
                filteredBooks = filteredBooks.filter(book => 
                    book.naw.toLowerCase().includes(searchTerm) ||
                    (book.author && book.author.toLowerCase().includes(searchTerm)) ||
                    (book.zhanar && book.zhanar.toLowerCase().includes(searchTerm))
                );
            }
            
            if (filteredBooks.length === 0) {
                const emptyMessage = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 2rem;">
                            <div class="empty-state">
                                <i class="fas fa-book"></i>
                                <h3>هیچ کتێبێک نەدۆزرایەوە</h3>
                                <p>کتێبێکی نوێ زیاد بکە</p>
                            </div>
                        </td>
                    </tr>
                `;
                adminBooksTable.innerHTML = emptyMessage;
                mobileAdminBooksTable.innerHTML = '<div class="empty-state"><i class="fas fa-book"></i><h3>هیچ کتێبێک نەدۆزرایەوە</h3><p>کتێبێکی نوێ زیاد بکە</p></div>';
                return;
            }
            
            // جدول دسکتاپ
            filteredBooks.forEach(book => {
                const isBorrowed = isBookBorrowed(book.naw);
                const hasPending = hasPendingRequests(book.naw);
                
                let statusText = 'بەردەستە';
                let statusClass = 'status-approved';
                
                if (isBorrowed) {
                    statusText = 'وەرگیراوە';
                    statusClass = 'status-pending';
                } else if (hasPending) {
                    statusText = 'چاوەڕوان';
                    statusClass = 'status-pending';
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><img src="${book.linkewena || 'https://images.unsplash.com/photo-1544716278-ca5e3f4abd8c?ixlib=rb-1.2.1&auto=format&fit=crop&w=100&q=80'}" alt="${book.naw}" style="width: 45px; height: 60px; object-fit: cover; border-radius: 5px;"></td>
                    <td><strong>${book.naw}</strong></td>
                    <td>${book.author || 'نەناسراو'}</td>
                    <td><span class="badge">${book.zhanar}</span></td>
                    <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                    <td>
                        <button class="action-btn edit-btn" data-id="${book.id}"><i class="fas fa-edit"></i> دەستکاری</button>
                        <button class="action-btn delete-btn" data-id="${book.id}"><i class="fas fa-trash"></i> سڕینەوە</button>
                    </td>
                `;
                
                adminBooksTable.appendChild(row);
            });
            
            // نمایش ریسپانسیو برای موبایل
            filteredBooks.forEach(book => {
                const isBorrowed = isBookBorrowed(book.naw);
                const hasPending = hasPendingRequests(book.naw);
                
                let statusText = 'بەردەستە';
                let statusClass = 'status-approved';
                
                if (isBorrowed) {
                    statusText = 'وەرگیراوە';
                    statusClass = 'status-pending';
                } else if (hasPending) {
                    statusText = 'چاوەڕوان';
                    statusClass = 'status-pending';
                }
                
                const mobileRow = document.createElement('div');
                mobileRow.className = 'mobile-table-row';
                mobileRow.innerHTML = `
                    <div class="mobile-table-cell">
                        <span class="mobile-table-label">وێنە:</span>
                        <span class="mobile-table-value">
                            <img src="${book.linkewena || 'https://images.unsplash.com/photo-1544716278-ca5e3f4abd8c?ixlib=rb-1.2.1&auto=format&fit=crop&w=100&q=80'}" alt="${book.naw}" class="book-image-thumb">
                        </span>
                    </div>
                    <div class="mobile-table-cell">
                        <span class="mobile-table-label">ناوی کتێب:</span>
                        <span class="mobile-table-value"><strong>${book.naw}</strong></span>
                    </div>
                    <div class="mobile-table-cell">
                        <span class="mobile-table-label">نووسەر:</span>
                        <span class="mobile-table-value">${book.author || 'نەناسراو'}</span>
                    </div>
                    <div class="mobile-table-cell">
                        <span class="mobile-table-label">ژانەر:</span>
                        <span class="mobile-table-value"><span class="badge">${book.zhanar}</span></span>
                    </div>
                    <div class="mobile-table-cell">
                        <span class="mobile-table-label">بارودۆخ:</span>
                        <span class="mobile-table-value"><span class="status-badge ${statusClass}">${statusText}</span></span>
                    </div>
                    <div class="mobile-action-buttons">
                        <button class="mobile-action-btn mobile-edit-btn" data-id="${book.id}">
                            <i class="fas fa-edit"></i> دەستکاری
                        </button>
                        <button class="mobile-action-btn mobile-delete-btn" data-id="${book.id}">
                            <i class="fas fa-trash"></i> سڕینەوە
                        </button>
                    </div>
                `;
                
                mobileAdminBooksTable.appendChild(mobileRow);
            });
            
            // Add event listeners to edit buttons
            document.querySelectorAll('.edit-btn, .mobile-edit-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const bookId = e.target.closest('button').getAttribute('data-id');
                    editBook(bookId);
                });
            });
            
            // Add event listeners to delete buttons
            document.querySelectorAll('.delete-btn, .mobile-delete-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const bookId = e.target.closest('button').getAttribute('data-id');
                    deleteBook(bookId);
                });
            });
        }

        // Display registered students with responsive design
        async function displayRegisteredStudentsFromFirebase(searchTerm = '') {
            registeredStudentsTable.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 2rem;"><div class="loading-spinner"></div></td></tr>';
            mobileRegisteredStudentsTable.innerHTML = '<div class="loading"><div class="loading-spinner"></div><p>بارکردنی زانیاریەکان...</p></div>';
            
            try {
                await loadAllRequestsFromFirebase();
                
                let filteredRequests = allRequests;
                
                if (currentStudentView === 'pending') {
                    filteredRequests = allRequests.filter(request => !request.pasand);
                } else if (currentStudentView === 'approved') {
                    filteredRequests = allRequests.filter(request => request.pasand === true && !request.returned);
                } else if (currentStudentView === 'returned') {
                    filteredRequests = allRequests.filter(request => request.returned === true);
                }
                
                if (searchTerm) {
                    filteredRequests = filteredRequests.filter(request => 
                        (request.name && request.name.toLowerCase().includes(searchTerm)) ||
                        (request.department && request.department.toLowerCase().includes(searchTerm)) ||
                        (request.bookTitle && request.bookTitle.toLowerCase().includes(searchTerm)) ||
                        (request.stage && request.stage.toLowerCase().includes(searchTerm)) ||
                        (request.number && request.number.includes(searchTerm))
                    );
                }
                
                displayRegisteredStudentsTable(filteredRequests);
                displayMobileRegisteredStudentsTable(filteredRequests);
                
            } catch (error) {
                console.error('Error loading students:', error);
                const errorMessage = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 2rem;">
                            <div class="empty-state">
                                <i class="fas fa-exclamation-triangle"></i>
                                <h3>هەڵە ڕوویدا</h3>
                                <p>ناتوانرێت زانیاریەکان باربکرێن</p>
                            </div>
                        </td>
                    </tr>
                `;
                registeredStudentsTable.innerHTML = errorMessage;
                mobileRegisteredStudentsTable.innerHTML = '<div class="empty-state"><i class="fas fa-exclamation-triangle"></i><h3>هەڵە ڕوویدا</h3><p>ناتوانرێت زانیاریەکان باربکرێن</p></div>';
            }
        }

        // Display registered students table for desktop
        function displayRegisteredStudentsTable(requests) {
            registeredStudentsTable.innerHTML = '';
            
            if (requests.length === 0) {
                const noDataText = currentStudentView === 'pending' 
                    ? 'هیچ داواکارییەکی چاوەڕوان نەکراوە' 
                    : currentStudentView === 'approved'
                    ? 'هیچ کتێبێک وەرگیراو نیە'
                    : 'هیچ کتێبێک گەڕێندراوەتەوە نیە';
                
                registeredStudentsTable.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 2rem;">
                            <div class="empty-state">
                                <i class="fas fa-inbox"></i>
                                <h3>${noDataText}</h3>
                                <p>کاتێک داواکاری نوێ هات، لێرە دەردەکەون</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            requests.forEach(request => {
                const statusText = request.returned ? 'گەڕێندراوەتەوە' : 
                                 request.pasand ? 'وەرگیراوە' : 'چاوەڕوان';
                const statusClass = request.returned ? 'status-rejected' : 
                                  request.pasand ? 'status-approved' : 'status-pending';
                const date = request.requestDate ? new Date(request.requestDate).toLocaleDateString('ku') : 'نەزانراو';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${request.name || '---'}</strong></td>
                    <td>${request.department || '---'}</td>
                    <td><span class="badge">${request.stage || '---'}</span></td>
                    <td>${request.number || '---'}</td>
                    <td><em>${request.bookTitle || 'هیچ کتێبێک'}</em></td>
                    <td>${date}</td>
                    <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                    <td>
                        ${!request.pasand ? 
                            `<button class="action-btn approve-btn" data-id="${request.id}"><i class="fas fa-check"></i> پەسەندکردن</button>
                             <button class="action-btn reject-btn" data-id="${request.id}"><i class="fas fa-times"></i> ڕەتکردنەوە</button>` 
                            : request.pasand && !request.returned ?
                            `<button class="action-btn reject-btn" data-id="${request.id}" data-action="return"><i class="fas fa-undo-alt"></i> گەڕاندنەوە</button>`
                            : ''}
                        <button class="action-btn delete-btn" data-id="${request.id}"><i class="fas fa-trash"></i> سڕینەوە</button>
                    </td>
                `;
                
                registeredStudentsTable.appendChild(row);
            });
            
            setupRequestActionButtons();
        }

        // Display mobile registered students table
        function displayMobileRegisteredStudentsTable(requests) {
            mobileRegisteredStudentsTable.innerHTML = '';
            
            if (requests.length === 0) {
                const noDataText = currentStudentView === 'pending' 
                    ? 'هیچ داواکارییەکی چاوەڕوان نەکراوە' 
                    : currentStudentView === 'approved'
                    ? 'هیچ کتێبێک وەرگیراو نیە'
                    : 'هیچ کتێبێک گەڕێندراوەتەوە نیە';
                
                mobileRegisteredStudentsTable.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-inbox"></i>
                        <h3>${noDataText}</h3>
                        <p>کاتێک داواکاری نوێ هات، لێرە دەردەکەون</p>
                    </div>
                `;
                return;
            }
            
            requests.forEach(request => {
                const statusText = request.returned ? 'گەڕێندراوەتەوە' : 
                                 request.pasand ? 'وەرگیراوە' : 'چاوەڕوان';
                const statusClass = request.returned ? 'status-rejected' : 
                                  request.pasand ? 'status-approved' : 'status-pending';
                const date = request.requestDate ? new Date(request.requestDate).toLocaleDateString('ku') : 'نەزانراو';
                
                const mobileRow = document.createElement('div');
                mobileRow.className = `mobile-table-row student-request-card ${currentStudentView}`;
                mobileRow.innerHTML = `
                    <div class="mobile-table-cell">
                        <span class="mobile-table-label">ناوی سیانی:</span>
                        <span class="mobile-table-value"><strong>${request.name || '---'}</strong></span>
                    </div>
                    <div class="mobile-table-cell">
                        <span class="mobile-table-label">بەش:</span>
                        <span class="mobile-table-value">${request.department || '---'}</span>
                    </div>
                    <div class="mobile-table-cell">
                        <span class="mobile-table-label">قۆناغ:</span>
                        <span class="mobile-table-value"><span class="badge">${request.stage || '---'}</span></span>
                    </div>
                    <div class="mobile-table-cell">
                        <span class="mobile-table-label">مۆبایل:</span>
                        <span class="mobile-table-value">${request.number || '---'}</span>
                    </div>
                    <div class="mobile-table-cell">
                        <span class="mobile-table-label">کتێب:</span>
                        <span class="mobile-table-value"><em>${request.bookTitle || 'هیچ کتێبێک'}</em></span>
                    </div>
                    <div class="mobile-table-cell">
                        <span class="mobile-table-label">بەروار:</span>
                        <span class="mobile-table-value">${date}</span>
                    </div>
                    <div class="mobile-table-cell">
                        <span class="mobile-table-label">بارودۆخ:</span>
                        <span class="mobile-table-value"><span class="status-badge ${statusClass}">${statusText}</span></span>
                    </div>
                    <div class="mobile-action-buttons">
                        ${!request.pasand ? 
                            `<button class="mobile-action-btn mobile-approve-btn" data-id="${request.id}">
                                <i class="fas fa-check"></i> پەسەندکردن
                            </button>
                            <button class="mobile-action-btn mobile-reject-btn" data-id="${request.id}">
                                <i class="fas fa-times"></i> ڕەتکردنەوە
                            </button>` 
                            : request.pasand && !request.returned ?
                            `<button class="mobile-action-btn mobile-reject-btn" data-id="${request.id}" data-action="return">
                                <i class="fas fa-undo-alt"></i> گەڕاندنەوە
                            </button>`
                            : ''}
                        <button class="mobile-action-btn mobile-delete-btn" data-id="${request.id}">
                            <i class="fas fa-trash"></i> سڕینەوە
                        </button>
                    </div>
                `;
                
                mobileRegisteredStudentsTable.appendChild(mobileRow);
            });
            
            setupMobileRequestActionButtons();
        }

        // Setup action buttons for desktop table
        function setupRequestActionButtons() {
            document.querySelectorAll('.approve-btn').forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    const requestId = e.target.closest('button').getAttribute('data-id');
                    await approveStudentRequest(requestId);
                });
            });
            
            document.querySelectorAll('.reject-btn').forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    const requestId = e.target.closest('button').getAttribute('data-id');
                    const action = btn.getAttribute('data-action');
                    
                    if (action === 'return') {
                        await returnBook(requestId);
                    } else {
                        await rejectStudentRequest(requestId);
                    }
                });
            });
            
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    const requestId = e.target.closest('button').getAttribute('data-id');
                    await deleteStudentRequest(requestId);
                });
            });
        }

        // Setup action buttons for mobile table
        function setupMobileRequestActionButtons() {
            document.querySelectorAll('.mobile-approve-btn').forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    const requestId = e.target.closest('button').getAttribute('data-id');
                    await approveStudentRequest(requestId);
                });
            });
            
            document.querySelectorAll('.mobile-reject-btn').forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    const requestId = e.target.closest('button').getAttribute('data-id');
                    const action = btn.getAttribute('data-action');
                    
                    if (action === 'return') {
                        await returnBook(requestId);
                    } else {
                        await rejectStudentRequest(requestId);
                    }
                });
            });
            
            document.querySelectorAll('.mobile-delete-btn').forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    const requestId = e.target.closest('button').getAttribute('data-id');
                    await deleteStudentRequest(requestId);
                });
            });
        }

        // Handle student registration for book borrowing
        async function handleStudentRegistration(e) {
            e.preventDefault();
            
            const studentName = document.getElementById('regStudentName').value;
            const department = document.getElementById('regDepartment').value;
            const stage = document.getElementById('regStage').value;
            const phoneNumber = document.getElementById('regPhoneNumber').value;
            
            let bookTitle = "";
            if (currentSelectedBook) {
                bookTitle = currentSelectedBook.naw;
            } else {
                showNotification('❌ تکایە یەکەم کتێبێک هەڵبژێرە بۆ داواکردن', 'error');
                return;
            }
            
            if (isBookBorrowed(bookTitle)) {
                showNotification('❌ پێشتر داوا کراە چاوەڕوان بە! تکایە کتێبێکی تر هەڵبژێرە.', 'error');
                return;
            }
            
            const userPendingRequest = allRequests.find(request => 
                request.name === studentName && 
                request.bookTitle === bookTitle && 
                !request.pasand
            );
            
            if (userPendingRequest) {
                showNotification('❌ تۆ پێشتر داواکاریت بۆ ئەم کتێبە ناردووە و چاوەڕوانی پەسەندکردنی.', 'warning');
                return;
            }
            
            const newRequest = {
                name: studentName,
                stage: stage,
                department: department,
                number: phoneNumber,
                bookTitle: bookTitle,
                pasand: false,
                requestDate: new Date().toISOString(),
                returned: false
            };
            
            try {
                const docRef = await addDoc(collection(db, "requests"), newRequest);
                
                confirmationMessage.style.display = 'block';
                studentRegistrationForm.reset();
                
                showNotification('✅ داواکاریەکەت بە سەرکەوتوویی نێردرا!', 'success');
                
                setTimeout(() => {
                    goToMainPage();
                }, 3000);
                
                await loadAllRequestsFromFirebase();
                displayBooks();
                updateStatistics();
                updateBorrowedBooksUI();
                
            } catch (error) {
                console.error('Error saving student request:', error);
                showNotification('❌ هەڵە ڕوویدا لە ناردنی داواکاری. تکایە دووبارە هەوڵبدەرەوە.', 'error');
            }
        }

        // Approve student request
        async function approveStudentRequest(requestId) {
            if (confirm('ئایا دڵنیای کە دەتەوێت ئەم داواکاریە پەسەند بکەیت؟')) {
                try {
                    const requestRef = doc(db, "requests", requestId);
                    await updateDoc(requestRef, {
                        pasand: true,
                        approvedDate: new Date().toISOString()
                    });
                    
                    await loadAllRequestsFromFirebase();
                    displayBooks();
                    updateStatistics();
                    updateBorrowedBooksUI();
                    showNotification('✅ داواکاریەکە پەسەندکرا و کتێبەکە وەرگیرا', 'success');
                    
                } catch (error) {
                    console.error('Error approving request:', error);
                    showNotification('❌ هەڵە ڕوویدا لە پەسەندکردنی داواکاری', 'error');
                }
            }
        }

        // Return book
        async function returnBook(requestId) {
            if (confirm('ئایا دڵنیای کە ئەم کتێبە گەڕێندراوەتەوە؟')) {
                try {
                    const request = allRequests.find(r => r.id === requestId);
                    if (!request) {
                        throw new Error("Request not found");
                    }
                    
                    const requestRef = doc(db, "requests", requestId);
                    await updateDoc(requestRef, {
                        returned: true,
                        returnDate: new Date().toISOString()
                    });
                    
                    await loadAllRequestsFromFirebase();
                    displayBooks();
                    updateStatistics();
                    updateBorrowedBooksUI();
                    showNotification('✅ کتێبەکە بە سەرکەوتوویی گەڕێندرایەوە', 'success');
                    
                } catch (error) {
                    console.error('Error returning book:', error);
                    showNotification('❌ هەڵە ڕوویدا لە گەڕاندنەوەی کتێب', 'error');
                }
            }
        }

        // Delete student request
        async function deleteStudentRequest(requestId) {
            if (confirm('ئایا دڵنیای کە دەتەوێت ئەم داواکاریە بسڕیتەوە؟')) {
                try {
                    const request = allRequests.find(r => r.id === requestId);
                    if (!request) {
                        throw new Error("Request not found");
                    }
                    
                    await deleteDoc(doc(db, "requests", requestId));
                    
                    await loadAllRequestsFromFirebase();
                    displayBooks();
                    updateStatistics();
                    updateBorrowedBooksUI();
                    showNotification('🗑️ داواکاریەکە بە سەرکەوتوویی سڕدرایەوە', 'success');
                    
                } catch (error) {
                    console.error('Error deleting request:', error);
                    showNotification('❌ هەڵە ڕوویدا لە سڕینەوەی داواکاری', 'error');
                }
            }
        }

        // Reject student request
        async function rejectStudentRequest(requestId) {
            if (confirm('ئایا دڵنیای کە دەتەوێت ئەم داواکاریە ڕەت بکەیتەوە؟')) {
                try {
                    await deleteDoc(doc(db, "requests", requestId));
                    
                    await loadAllRequestsFromFirebase();
                    displayBooks();
                    updateStatistics();
                    updateBorrowedBooksUI();
                    showNotification('❌ داواکاریەکە ڕەتکرایەوە', 'success');
                    
                } catch (error) {
                    console.error('Error rejecting request:', error);
                    showNotification('❌ هەڵە ڕوویدا لە ڕەتکردنەوەی داواکاری', 'error');
                }
            }
        }

        // Handle admin login
        function handleAdminLogin(e) {
            e.preventDefault();
            
            const username = document.getElementById('adminUsername').value;
            const password = document.getElementById('adminPassword').value;
            
            if (username === ADMIN_USERNAME && password === ADMIN_PASSWORD) {
                currentUser = { username, role: 'admin' };
                adminLoginModal.classList.remove('active');
                adminLoginForm.reset();
                loginError.style.display = 'none';
                
                mainPage.style.display = 'none';
                registrationPage.style.display = 'none';
                adminPanel.style.display = 'block';
                
                displayAdminBooks();
                displayRegisteredStudentsFromFirebase();
                
                showNotification('✅ بە سەرکەوتوویی چووتە ژوورەوە وەک ئەدمین', 'success');
            } else {
                loginError.style.display = 'block';
            }
        }

        // Show book form for adding/editing
        function showBookForm(book = null) {
            editingBookId = book ? book.id : null;
            
            if (book) {
                bookFormTitle.textContent = '📝 دەستکاریکردنی کتێب';
                document.getElementById('bookId').value = book.id;
                document.getElementById('bookTitle').value = book.naw;
                document.getElementById('bookAuthor').value = book.author || '';
                document.getElementById('bookGenre').value = book.zhanar || '';
                document.getElementById('bookSummary').value = book.kurta || '';
                document.getElementById('bookImage').value = book.linkewena || '';
                bookFormSubmitBtn.innerHTML = '<i class="fas fa-save"></i> نوێکردنەوە';
            } else {
                bookFormTitle.textContent = '📖 زیادکردنی کتێبی نوێ';
                resetBookForm();
                bookFormSubmitBtn.innerHTML = '<i class="fas fa-save"></i> پاشەکەوت';
            }
            
            bookFormModal.classList.add('active');
        }

        // Reset book form
        function resetBookForm() {
            bookForm.reset();
            document.getElementById('bookId').value = '';
            editingBookId = null;
        }

        // Handle book form submission
        async function handleBookFormSubmit(e) {
            e.preventDefault();
            
            const bookData = {
                name: document.getElementById('bookTitle').value,
                authorName: document.getElementById('bookAuthor').value,
                genre: document.getElementById('bookGenre').value,
                summary: document.getElementById('bookSummary').value,
                imgUrl: document.getElementById('bookImage').value,
                createdAt: new Date().toISOString()
            };
            
            try {
                if (editingBookId) {
                    const bookRef = doc(db, "Slahaddin", editingBookId);
                    await updateDoc(bookRef, bookData);
                    
                    showNotification('✅ کتێبەکە بە سەرکەوتوویی نوێکرایەوە', 'success');
                } else {
                    await addDoc(collection(db, "Slahaddin"), bookData);
                    
                    showNotification('✅ کتێبەکە بە سەرکەوتوویی زیادکرا', 'success');
                }
                
                await loadBooksFromFirebase();
                
                bookFormModal.classList.remove('active');
                resetBookForm();
                displayBooks();
                displayAdminBooks();
                updateStatistics();
                
            } catch (error) {
                console.error('Error saving book:', error);
                showNotification('❌ هەڵە ڕوویدا لە پاشەکەوتکردنی کتێب', 'error');
            }
        }

        // Edit book
        function editBook(bookId) {
            const book = books.find(b => b.id === bookId);
            if (book) {
                showBookForm(book);
            }
        }

        // Delete book
        async function deleteBook(bookId) {
            if (confirm('ئایا دڵنیای کە دەتەوێت ئەم کتێبە بسڕیتەوە؟')) {
                try {
                    const bookTitle = books.find(b => b.id === bookId)?.naw;
                    const hasRequests = allRequests.some(r => r.bookTitle === bookTitle);
                    
                    if (hasRequests) {
                        if (!confirm('ئەم کتێبە داواکاری هەیە. ئایا هێشتا دەتەوێت بسڕیتەوە؟')) {
                            return;
                        }
                    }
                    
                    await deleteDoc(doc(db, "Slahaddin", bookId));
                    
                    wishlist = wishlist.filter(item => item.id !== bookId);
                    saveWishlistToLocalStorage();
                    updateWishlistCount();
                    updateWishlistUI();
                    
                    await loadBooksFromFirebase();
                    
                    displayBooks();
                    displayAdminBooks();
                    updateStatistics();
                    
                    showNotification('🗑️ کتێبەکە بە سەرکەوتوویی سڕدرایەوە', 'success');
                    
                } catch (error) {
                    console.error('Error deleting book:', error);
                    showNotification('❌ هەڵە ڕوویدا لە سڕینەوەی کتێب', 'error');
                }
            }
        }

        // Show search suggestions
        function showSearchSuggestions(searchTerm, suggestionsContainer) {
            const filteredBooks = books.filter(book => 
                book.naw.toLowerCase().includes(searchTerm) ||
                (book.author && book.author.toLowerCase().includes(searchTerm)) ||
                (book.zhanar && book.zhanar.toLowerCase().includes(searchTerm))
            );
            
            suggestionsContainer.innerHTML = '';
            
            if (filteredBooks.length === 0) {
                suggestionsContainer.innerHTML = '<div class="suggestion-item">هیچ کتێبێک نەدۆزرایەوە</div>';
            } else {
                filteredBooks.slice(0, 5).forEach(book => {
                    const suggestion = document.createElement('div');
                    suggestion.className = 'suggestion-item';
                    suggestion.innerHTML = `
                        <strong>${book.naw}</strong><br>
                        <small>${book.author || 'نەناسراو'} - ${book.zhanar}</small>
                    `;
                    suggestion.addEventListener('click', () => {
                        searchInput.value = book.naw;
                        currentSearch = book.naw.toLowerCase();
                        suggestionsContainer.classList.remove('active');
                        displayBooks();
                        showBookDetails(book);
                    });
                    suggestionsContainer.appendChild(suggestion);
                });
            }
            
            suggestionsContainer.classList.add('active');
        }

        // Show student search suggestions
        function showStudentSearchSuggestions(searchTerm) {
            const filteredRequests = allRequests.filter(request => 
                (request.name && request.name.toLowerCase().includes(searchTerm)) ||
                (request.department && request.department.toLowerCase().includes(searchTerm)) ||
                (request.bookTitle && request.bookTitle.toLowerCase().includes(searchTerm))
            );
            
            studentSearchSuggestions.innerHTML = '';
            
            if (filteredRequests.length === 0) {
                studentSearchSuggestions.innerHTML = '<div class="suggestion-item">هیچ خوێندکارێک نەدۆزرایەوە</div>';
            } else {
                filteredRequests.slice(0, 5).forEach(request => {
                    const suggestion = document.createElement('div');
                    suggestion.className = 'suggestion-item';
                    suggestion.innerHTML = `
                        <strong>${request.name}</strong><br>
                        <small>${request.department} - ${request.bookTitle}</small>
                    `;
                    suggestion.addEventListener('click', () => {
                        studentSearchInput.value = request.name;
                        studentSearchSuggestions.classList.remove('active');
                        displayRegisteredStudents(request.name.toLowerCase());
                    });
                    studentSearchSuggestions.appendChild(suggestion);
                });
            }
            
            studentSearchSuggestions.classList.add('active');
        }

        // Display registered students with search
        function displayRegisteredStudents(searchTerm = '') {
            let filteredRequests = allRequests;
            
            if (currentStudentView === 'pending') {
                filteredRequests = allRequests.filter(request => !request.pasand);
            } else if (currentStudentView === 'approved') {
                filteredRequests = allRequests.filter(request => request.pasand === true && !request.returned);
            } else if (currentStudentView === 'returned') {
                filteredRequests = allRequests.filter(request => request.returned === true);
            }
            
            if (searchTerm) {
                filteredRequests = filteredRequests.filter(request => 
                    (request.name && request.name.toLowerCase().includes(searchTerm)) ||
                    (request.department && request.department.toLowerCase().includes(searchTerm)) ||
                    (request.bookTitle && request.bookTitle.toLowerCase().includes(searchTerm))
                );
            }
            
            displayRegisteredStudentsTable(filteredRequests);
            displayMobileRegisteredStudentsTable(filteredRequests);
        }

        // Update student view buttons
        function updateStudentViewButtons() {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            if (currentStudentView === 'pending') {
                showPendingBtn.classList.add('active');
            } else if (currentStudentView === 'approved') {
                showApprovedBtn.classList.add('active');
            } else if (currentStudentView === 'returned') {
                showReturnedBtn.classList.add('active');
            }
        }

        // Show notification
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}-notification`;
            
            let icon = 'fas fa-check-circle';
            if (type === 'error') icon = 'fas fa-exclamation-circle';
            if (type === 'warning') icon = 'fas fa-exclamation-triangle';
            
            notification.innerHTML = `
                <i class="${icon}"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideIn 0.3s cubic-bezier(0.4, 0, 0.2, 1) reverse';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 5000);
        }
    </script>
</body>
</html>
